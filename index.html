<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="احجز جلسة العلاج الطبيعي في PhysioCare - أفضل مراكز العلاج الطبيعي في مصر" />
  <meta name="keywords" content="علاج طبيعي, حجز جلسة, PhysioCare, العلاج الطبيعي, مصر" />
  <meta name="author" content="PhysioCare" />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="PhysioCare - حجز جلسة علاج طبيعي" />
  <meta property="og:description" content="احجز جلستك العلاجية بسهولة وأمان مع أفضل أطباء العلاج الطبيعي" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://physiocare.com" />
  <meta property="og:image" content="https://physiocare.com/images/logo.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <title>PhysioCare | حجز جلسة علاج طبيعي</title>
  
  <!-- Preconnect to external domains for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://cdn-icons-png.flaticon.com">
  <link rel="preconnect" href="https://unpkg.com">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Logo Animation Styles -->
  <link rel="stylesheet" href="logo-styles.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <style>
    /* CSS Custom Properties for better maintainability */
    :root {
      --primary-color: #005f73;
      --primary-light: #0a9396;
      --secondary-color: #009688;
      --secondary-light: #1cc7a8;
      --accent-color: #94d2bd;
      --success-color: #28a745;
      --error-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
      --light-bg: #f8f9fa;
      --white: #ffffff;
      --dark-text: #343a40;
      --gray-text: #6c757d;
      --border-color: #ced4da;
      --border-light: #e9ecef;
      --shadow-light: 0 2px 4px rgba(0,0,0,0.04);
      --shadow-medium: 0 4px 8px rgba(0,0,0,0.08);
      --shadow-heavy: 0 10px 30px rgba(0,0,0,0.08);
      --border-radius: 8px;
      --border-radius-large: 16px;
      --transition: all 0.3s ease;
      --font-family: 'Cairo', sans-serif;
      --max-width: 900px;
    }

    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark-text);
      direction: rtl;
      line-height: 1.6;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: var(--white);
      padding: 8px;
      text-decoration: none;
      border-radius: var(--border-radius);
      z-index: 1000;
    }

    .skip-link:focus {
      top: 6px;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      padding: 40px 20px;
      text-align: center;
      color: var(--white);
      box-shadow: var(--shadow-heavy);
      border-bottom: 4px solid var(--accent-color);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.1;
      pointer-events: none;
    }

    .header-content {
      position: relative;
      z-index: 2;
    }

    header h1 {
      margin: 0;
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      letter-spacing: 1px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    /* Updated logo styles to integrate with animated logo */
    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    header p {
      margin: 10px 0 0;
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 400;
      opacity: 0.95;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 24px;
      background: var(--white);
      border: 2px solid var(--border-light);
      border-radius: 25px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      color: var(--gray-text);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-tab:hover {
      background: var(--primary-color);
      color: var(--white);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .nav-tab.active {
      background: var(--primary-color);
      color: var(--white);
      border-color: var(--primary-color);
    }

    /* Main Container */
    .container {
      max-width: var(--max-width);
      background: var(--white);
      margin: 30px auto;
      padding: 40px;
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-heavy);
      border-top: 5px solid var(--secondary-color);
      position: relative;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
    }

    /* Typography */
    h2 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    h3 {
      text-align: center;
      color: var(--primary-color);
      margin-top: 40px;
      margin-bottom: 20px;
      border-top: 1px solid var(--border-light);
      padding-top: 30px;
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      font-weight: 600;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 25px;
      position: relative;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    label {
      display: block;
      margin: 0 0 8px;
      font-weight: 700;
      color: var(--gray-text);
      font-size: 1.1rem;
      cursor: pointer;
    }

    .required::after {
      content: ' *';
      color: var(--error-color);
      font-weight: bold;
    }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 15px;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-family: var(--font-family);
      background-color: #fdfdff;
      transition: var(--transition);
      box-sizing: border-box;
      outline: none;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #007BFF;
      background-color: var(--white);
      box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1);
      transform: translateY(-1px);
    }

    /* Input validation styles */
    input.invalid,
    textarea.invalid,
    select.invalid {
      border-color: var(--error-color);
      background-color: #fff5f5;
      animation: shake 0.5s ease-in-out;
    }

    input.valid,
    textarea.valid,
    select.valid {
      border-color: var(--success-color);
      background-color: #f8fff8;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .error-message {
      color: var(--error-color);
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
      font-weight: 600;
      animation: fadeIn 0.3s ease-in-out;
    }

    .success-message {
      color: var(--success-color);
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
      font-weight: 600;
      animation: fadeIn 0.3s ease-in-out;
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    /* Choice Buttons */
    .choice-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      gap: 12px;
      margin: 10px 0 25px;
    }

    .choice-button {
      padding: 12px 25px;
      border: 2px solid var(--border-light);
      background: var(--light-bg);
      color: var(--gray-text);
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 700;
      box-shadow: var(--shadow-light);
      position: relative;
      overflow: hidden;
      min-width: 120px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .choice-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .choice-button:hover::before {
      left: 100%;
    }

    .choice-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: #007BFF;
      color: #007BFF;
    }

    .choice-button:focus {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }

    .choice-button.active {
      background: linear-gradient(135deg, #007BFF, #0056b3);
      color: var(--white);
      border-color: #0056b3;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      transform: translateY(-2px);
    }

    .choice-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Time slots grid */
    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin: 15px 0;
    }

    .time-slot {
      padding: 15px 10px;
      border: 2px solid var(--border-light);
      background: var(--white);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      position: relative;
    }

    .time-slot:hover {
      border-color: var(--secondary-color);
      background: var(--light-bg);
      transform: translateY(-2px);
    }

    .time-slot.active {
      background: var(--secondary-color);
      color: var(--white);
      border-color: var(--secondary-color);
    }

    .time-slot.unavailable {
      background: #f8f9fa;
      color: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* File Upload Section */
    .file-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .file-box {
      position: relative;
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      background-color: #fdfdff;
      transition: var(--transition);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 140px;
      overflow: hidden;
    }

    .file-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(0,123,255,0.05) 50%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .file-box:hover::before {
      opacity: 1;
    }

    .file-box:hover {
      border-color: #007BFF;
      background-color: #f8faff;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
    }

    .file-box:focus-within {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }

    .file-box label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--gray-text);
      margin: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    .file-box .icon,
    .file-box img {
      font-size: 2.5rem;
      line-height: 1;
      filter: grayscale(50%);
      transition: var(--transition);
    }

    .file-box:hover .icon,
    .file-box:hover img {
      filter: grayscale(0%);
      transform: scale(1.1);
    }

    .file-box img {
      width: 50px;
      height: 50px;
      object-fit: contain;
    }

    .file-box input[type="file"] {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      z-index: 1;
    }

    .file-box.has-file {
      border-color: var(--success-color);
      background-color: #f8fff8;
      border-style: solid;
    }

    .file-box.has-file .icon {
      color: var(--success-color);
    }

    .file-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: var(--success-color);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 0 0 12px 12px;
    }

    /* Submit Button */
    .submit-container {
      margin-top: 40px;
      text-align: center;
    }

    button[type="submit"] {
      background: linear-gradient(135deg, var(--secondary-light) 0%, var(--secondary-color) 100%);
      color: var(--white);
      border: none;
      padding: 18px 40px;
      width: 100%;
      max-width: 400px;
      font-size: 1.2rem;
      font-weight: 700;
      font-family: var(--font-family);
      border-radius: 12px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 5px 20px rgba(0, 150, 136, 0.3);
      position: relative;
      overflow: hidden;
    }

    button[type="submit"]::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }

    button[type="submit"]:hover:not(:disabled)::before {
      left: 100%;
    }

    button[type="submit"]:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(0, 150, 136, 0.4);
    }

    button[type="submit"]:focus {
      outline: 3px solid rgba(0, 150, 136, 0.5);
      outline-offset: 2px;
    }

    button[type="submit"]:disabled {
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
      opacity: 0.7;
    }

    /* Shift Options */
    .shift-options {
      background: var(--light-bg);
      padding: 25px;
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
        max-height: 0;
      }
      to {
        opacity: 1;
        transform: translateY(0);
        max-height: 1000px;
      }
    }

    /* Insurance Options */
    .insurance-options {
      background: var(--light-bg);
      padding: 25px;
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      animation: slideDown 0.3s ease-out;
      display: none;
    }

    /* Doctor Selection */
    .doctor-selection {
      background: var(--light-bg);
      padding: 25px;
      margin-top: 20px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      animation: slideDown 0.3s ease-out;
      display: none;
    }

    .doctor-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }

    .doctor-card {
      padding: 15px;
      border: 2px solid var(--border-light);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      background: var(--white);
    }

    .doctor-card:hover {
      border-color: var(--secondary-color);
      transform: translateY(-2px);
    }

    .doctor-card.selected {
      border-color: var(--secondary-color);
      background: var(--secondary-color);
      color: var(--white);
    }

    /* Message Notifications */
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: var(--border-radius);
      z-index: 1000;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideInRight 0.3s ease-out;
      max-width: 350px;
      min-width: 250px;
      backdrop-filter: blur(10px);
    }

    .message.success {
      background: rgba(212, 237, 218, 0.95);
      color: #155724;
      border: 1px solid #c3e6cb;
      border-left: 4px solid var(--success-color);
    }

    .message.error {
      background: rgba(248, 215, 218, 0.95);
      color: #721c24;
      border: 1px solid #f5c6cb;
      border-left: 4px solid var(--error-color);
    }

    .message.info {
      background: rgba(209, 236, 241, 0.95);
      color: #0c5460;
      border: 1px solid #bee5eb;
      border-left: 4px solid var(--info-color);
    }

    .message.warning {
      background: rgba(255, 243, 205, 0.95);
      color: #856404;
      border: 1px solid #ffeaa7;
      border-left: 4px solid var(--warning-color);
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 6px;
      background: var(--border-light);
      border-radius: 3px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--secondary-color), var(--secondary-light));
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 3px;
    }

    /* Rating System */
    .rating-container {
      text-align: center;
      margin: 20px 0;
    }

    .rating-stars {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 10px 0;
    }

    .star {
      font-size: 2rem;
      color: #ddd;
      cursor: pointer;
      transition: var(--transition);
    }

    .star:hover,
    .star.active {
      color: #ffc107;
      transform: scale(1.1);
    }

    /* Map Container */
    .map-container {
      height: 300px;
      border-radius: 12px;
      overflow: hidden;
      margin: 20px 0;
      border: 2px solid var(--border-light);
    }

    /* Chat Bot */
    .chatbot-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 350px;
      height: 500px;
      background: var(--white);
      border-radius: 12px;
      box-shadow: var(--shadow-heavy);
      display: none;
      flex-direction: column;
      z-index: 1000;
    }

    .chatbot-header {
      background: var(--primary-color);
      color: var(--white);
      padding: 15px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .chatbot-messages {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      max-height: 350px;
    }

    .chatbot-input {
      padding: 15px;
      border-top: 1px solid var(--border-light);
      display: flex;
      gap: 10px;
    }

    .chatbot-toggle {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background: var(--primary-color);
      color: var(--white);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.5rem;
      box-shadow: var(--shadow-medium);
      transition: var(--transition);
      z-index: 1001;
    }

    .chatbot-toggle:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-heavy);
    }

    /* Calendar */
    .calendar-container {
      background: var(--white);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      border: 1px solid var(--border-light);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .calendar-day {
      padding: 10px;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .calendar-day:hover {
      background: var(--light-bg);
    }

    .calendar-day.available {
      background: var(--success-color);
      color: var(--white);
    }

    .calendar-day.selected {
      background: var(--primary-color);
      color: var(--white);
    }

    /* Footer */
    footer {
      text-align: center;
      color: #888;
      margin: 50px 0 20px;
      font-size: 0.9rem;
      padding: 30px 20px;
      border-top: 1px solid var(--border-light);
      background: var(--white);
      border-radius: var(--border-radius-large);
    }

    .footer-content {
      max-width: var(--max-width);
      margin: 0 auto;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
    }

    .footer-links a:hover {
      color: var(--secondary-color);
    }

    .social-links {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
    }

    .social-link {
      width: 40px;
      height: 40px;
      background: var(--primary-color);
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      transition: var(--transition);
    }

    .social-link:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }

    /* Accessibility improvements */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Focus indicators */
    *:focus {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      :root {
        --border-color: #000;
        --gray-text: #000;
      }
    }

    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --light-bg: #1a1a1a;
        --white: #2d2d2d;
        --dark-text: #e0e0e0;
        --gray-text: #b0b0b0;
        --border-color: #404040;
        --border-light: #333;
      }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        margin: 20px;
        padding: 25px;
      }

      header {
        padding: 30px 15px;
      }

      .choice-group {
        flex-direction: column;
      }

      .choice-button {
        width: 100%;
        text-align: center;
        min-width: auto;
      }

      .file-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .message {
        right: 10px;
        left: 10px;
        max-width: none;
      }

      button[type="submit"] {
        padding: 16px 30px;
        font-size: 1.1rem;
      }

      .nav-tabs {
        flex-direction: column;
        align-items: center;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .time-slots {
        grid-template-columns: repeat(2, 1fr);
      }

      .chatbot-container {
        width: 90%;
        height: 70%;
        bottom: 10px;
        left: 5%;
      }
    }

    @media (max-width: 480px) {
      .file-grid {
        grid-template-columns: 1fr;
      }

      header {
        padding: 20px 10px;
      }

      .container {
        margin: 10px;
        padding: 20px;
      }

      .choice-button {
        padding: 14px 20px;
        font-size: 0.95rem;
      }

      .time-slots {
        grid-template-columns: 1fr;
      }
    }

    /* Print styles */
    @media print {
      header {
        background: none !important;
        color: #000 !important;
        box-shadow: none !important;
      }

      .container {
        box-shadow: none !important;
        border: 1px solid #000 !important;
      }

      .choice-button {
        border: 1px solid #000 !important;
        background: none !important;
      }

      .message, .chatbot-container, .chatbot-toggle {
        display: none !important;
      }
    }
  </style>
</head>

<body>
  <!-- Skip link for accessibility -->
  <a href="#main-content" class="skip-link">انتقل إلى المحتوى الرئيسي</a>

  <!-- Loading overlay -->
  <div class="loading-overlay" id="loading-overlay" aria-hidden="true">
    <div class="loading-spinner"></div>
  </div>

  <header role="banner">
    <div class="header-content">
      <!-- Animated Logo Integration -->
      <div class="logo-container">
        <div class="physiocare-logo-header">
          <div class="physiocare-logo-container">
            <img src="/public/eqq.jpg" alt="PhysioCare Logo" class="physiocare-logo-image">
          </div>
          <!-- العناصر المتحركة -->
          <div class="physiocare-logo-ring-1"></div>
          <div class="physiocare-logo-ring-2"></div>
          <div class="physiocare-logo-glow-1"></div>
          <div class="physiocare-logo-glow-2"></div>
          <div class="physiocare-logo-float-1"></div>
          <div class="physiocare-logo-float-2"></div>
          <div class="physiocare-logo-float-3"></div>
          <div class="physiocare-logo-badge">معتمد</div>
        </div>
      </div>
      
      <h1>PhysioCare</h1>
      <p>مركز متخصص في العلاج الطبيعي والتأهيل الطبي</p>
    </div>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs" role="navigation" aria-label="التنقل الرئيسي">
      <a href="#booking" class="nav-tab active" data-tab="booking">
        <i class="fas fa-calendar-plus"></i>
        حجز جلسة
      </a>
      <a href="#services" class="nav-tab" data-tab="services">
        <i class="fas fa-stethoscope"></i>
        خدماتنا
      </a>
      <a href="#branches" class="nav-tab" data-tab="branches">
        <i class="fas fa-map-marker-alt"></i>
        فروعنا
      </a>
      <a href="#about" class="nav-tab" data-tab="about">
        <i class="fas fa-info-circle"></i>
        من نحن
      </a>
      <a href="#contact" class="nav-tab" data-tab="contact">
        <i class="fas fa-phone"></i>
        تواصل معنا
      </a>
    </nav>
  </header>

  <main id="main-content" role="main">
    <!-- Booking Tab -->
    <div id="booking" class="tab-content active">
      <div class="container">
        <h2>
          <i class="fas fa-calendar-check"></i>
          نموذج حجز جلسة علاج طبيعي
        </h2>

        <!-- Progress bar -->
        <div class="progress-bar" aria-label="تقدم النموذج">
          <div class="progress-fill" id="progress-fill"></div>
        </div>

        <form id="booking-form" novalidate aria-label="نموذج حجز جلسة علاج طبيعي">
          <div class="form-row">
            <div class="form-group">
              <label for="name" class="required">الاسم الكامل</label>
              <input 
                type="text" 
                id="name" 
                name="name"
                required 
                placeholder="اكتب اسمك ثلاثي"
                aria-describedby="name-error name-help"
                autocomplete="name"
                minlength="6"
                maxlength="50"
              >
              <div class="error-message" id="name-error" role="alert" aria-live="polite"></div>
              <div class="success-message" id="name-success" role="status" aria-live="polite"></div>
              <div id="name-help" class="sr-only">يجب أن يكون الاسم ثلاثي على الأقل</div>
            </div>

            <div class="form-group">
              <label for="phone" class="required">رقم الهاتف</label>
              <input 
                type="tel" 
                id="phone" 
                name="phone"
                required 
                placeholder="01XXXXXXXXX"
                aria-describedby="phone-error phone-help"
                autocomplete="tel"
                pattern="^01[0-2,5]{1}[0-9]{8}$"
                maxlength="11"
              >
              <div class="error-message" id="phone-error" role="alert" aria-live="polite"></div>
              <div class="success-message" id="phone-success" role="status" aria-live="polite"></div>
              <div id="phone-help" class="sr-only">رقم الهاتف يجب أن يبدأ بـ 01 ويكون 11 رقم</div>
            </div>
          </div>

          <div class="form-group">
            <label for="alt-phone">رقم هاتف احتياطي (اختياري)</label>
            <input 
              type="tel" 
              id="alt-phone" 
              name="alt-phone"
              placeholder="01XXXXXXXXX"
              aria-describedby="alt-phone-error"
              autocomplete="tel"
              pattern="^01[0-2,5]{1}[0-9]{8}$"
              maxlength="11"
            >
            <div class="error-message" id="alt-phone-error" role="alert" aria-live="polite"></div>
            <div class="success-message" id="alt-phone-success" role="status" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label class="required">نوع الدفع</label>
            <div class="choice-group" id="payment-type-buttons" role="radiogroup" aria-label="اختر نوع الدفع">
              <button type="button" class="choice-button" data-value="تأمين" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                تأمين
              </button>
              <button type="button" class="choice-button" data-value="كاش" role="radio" aria-checked="false">
                <i class="fas fa-money-bill-wave"></i>
                كاش
              </button>
            </div>
            <input type="hidden" id="payment-type" name="payment-type" required>
            <div class="error-message" id="payment-type-error" role="alert" aria-live="polite"></div>
          </div>

          <!-- Insurance Options (Hidden by default) -->
          <div id="insurance-options" class="insurance-options" aria-live="polite">
            <h3>
              <i class="fas fa-shield-alt"></i>
              اختر شركة التأمين
            </h3>
            <div class="choice-group" id="insurance-buttons" role="radiogroup" aria-label="اختر شركة التأمين">
              <button type="button" class="choice-button" data-value="Globmed" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                Globmed
              </button>
              <button type="button" class="choice-button" data-value="NextCare" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                NextCare
              </button>
              <button type="button" class="choice-button" data-value="AXA" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                AXA
              </button>
              <button type="button" class="choice-button" data-value="Metlife (Alico)" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                Metlife
              </button>
              <button type="button" class="choice-button" data-value="MedRight" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                MedRight
              </button>
              <button type="button" class="choice-button" data-value="Enppi" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                Enppi
              </button>
              <button type="button" class="choice-button" data-value="Bupa" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                Bupa
              </button>
              <button type="button" class="choice-button" data-value="Egymed" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                Egymed
              </button>
              <button type="button" class="choice-button" data-value="LimitlessCare" role="radio" aria-checked="false">
                <i class="fas fa-shield-alt"></i>
                LimitlessCare
              </button>
            </div>
            <input type="hidden" id="insurance" name="insurance">
            <div class="error-message" id="insurance-error" role="alert" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label class="required">اختر الفرع</label>
            <div class="choice-group" id="branch-buttons" role="radiogroup" aria-label="اختر الفرع">
              <button type="button" class="choice-button" data-value="الشيخ زايد - إيدن مول" role="radio" aria-checked="false">
                <i class="fas fa-building"></i>
                إيدن مول
              </button>
              <button type="button" class="choice-button" data-value="الشيخ زايد - أركان مول" role="radio" aria-checked="false">
                <i class="fas fa-building"></i>
                أركان مول
              </button>
              <button type="button" class="choice-button" data-value="المعادي" role="radio" aria-checked="false">
                <i class="fas fa-building"></i>
                المعادي
              </button>
              <button type="button" class="choice-button" data-value="المهندسين" role="radio" aria-checked="false">
                <i class="fas fa-building"></i>
                المهندسين
              </button>
              <button type="button" class="choice-button" data-value="التجمع الخامس" role="radio" aria-checked="false">
                <i class="fas fa-building"></i>
                التجمع
              </button>
            </div>
            <input type="hidden" id="branch" name="branch" required>
            <div class="error-message" id="branch-error" role="alert" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label for="date" class="required">التاريخ</label>
            <input 
              type="date" 
              id="date" 
              name="date"
              required
              aria-describedby="date-error date-help"
            >
            <div class="error-message" id="date-error" role="alert" aria-live="polite"></div>
            <div class="success-message" id="date-success" role="status" aria-live="polite"></div>
            <div id="date-help" class="sr-only">اختر تاريخ من الغد حتى شهرين قادمين</div>
          </div>

          <div class="form-group">
            <label class="required">اختيار الأيام</label>
            <div class="choice-group" id="days-buttons" role="radiogroup" aria-label="اختر الأيام">
              <button type="button" class="choice-button" data-value="سبت-اثنين-أربعاء" role="radio" aria-checked="false">
                <i class="fas fa-calendar-week"></i>
                سبت - اثنين - أربعاء
              </button>
              <button type="button" class="choice-button" data-value="أحد-ثلاثاء-خميس" role="radio" aria-checked="false">
                <i class="fas fa-calendar-week"></i>
                أحد - ثلاثاء - خميس
              </button>
              <button type="button" class="choice-button" data-value="أي-أيام" role="radio" aria-checked="false">
                <i class="fas fa-calendar"></i>
                أي أيام
              </button>
            </div>
            <input type="hidden" id="selected-days" name="selected-days" required>
            <div class="error-message" id="days-error" role="alert" aria-live="polite"></div>
          </div>

          <div class="form-group">
            <label class="required">اختيار الشيفت</label>
            <div class="choice-group" id="shift-buttons" role="radiogroup" aria-label="اختر الشيفت">
              <button type="button" class="choice-button" data-value="صباحي" role="radio" aria-checked="false">
                <i class="fas fa-sun"></i>
                صباحي (10:30 ص - 4:30 م)
              </button>
              <button type="button" class="choice-button" data-value="مسائي" role="radio" aria-checked="false">
                <i class="fas fa-moon"></i>
                مسائي (4:30 م - 9:50 م)
              </button>
            </div>
            <input type="hidden" id="shift" name="shift" required>
            <div class="error-message" id="shift-error" role="alert" aria-live="polite"></div>
          </div>

          <!-- Morning Shift Options -->
          <div id="morning-options" class="shift-options" style="display:none" aria-live="polite">
            <h3>
              <i class="fas fa-sun"></i>
              خيارات الشيفت الصباحي
            </h3>
            
            <div class="form-group">
              <label>اختيار المواعيد الصباحية (يمكنك اختيار أكثر من موعد)</label>
              <p style="font-size: 0.9rem; color: var(--gray-text); margin-bottom: 15px;">
                <i class="fas fa-info-circle"></i>
                يمكنك اختيار عدة مواعيد وسيتم التواصل معك لتأكيد الموعد المناسب
              </p>
              <div class="time-slots" id="morning-time-slots">
                <div class="time-slot" data-value="10:30 ص">10:30 ص</div>
                <div class="time-slot" data-value="11:10 ص">11:10 ص</div>
                <div class="time-slot" data-value="11:50 ص">11:50 ص</div>
                <div class="time-slot" data-value="12:30 م">12:30 م</div>
                <div class="time-slot" data-value="1:10 م">1:10 م</div>
                <div class="time-slot" data-value="1:50 م">1:50 م</div>
                <div class="time-slot" data-value="2:30 م">2:30 م</div>
                <div class="time-slot" data-value="3:10 م">3:10 م</div>
                <div class="time-slot" data-value="3:50 م">3:50 م</div>
              </div>
              <input type="hidden" id="morning-time" name="morning-time">
              <div class="error-message" id="morning-time-error" role="alert" aria-live="polite"></div>
            </div>
          </div>

          <!-- Evening Shift Options -->
          <div id="evening-options" class="shift-options" style="display:none" aria-live="polite">
            <h3>
              <i class="fas fa-moon"></i>
              خيارات الشيفت المسائي
            </h3>
            
            <div class="form-group">
              <label>اختيار المواعيد المسائية (يمكنك اختيار أكثر من موعد)</label>
              <p style="font-size: 0.9rem; color: var(--gray-text); margin-bottom: 15px;">
                <i class="fas fa-info-circle"></i>
                يمكنك اختيار عدة مواعيد وسيتم التواصل معك لتأكيد الموعد المناسب
              </p>
              <div class="time-slots" id="evening-time-slots">
                <div class="time-slot" data-value="4:30 م">4:30 م</div>
                <div class="time-slot" data-value="5:10 م">5:10 م</div>
                <div class="time-slot" data-value="5:50 م">5:50 م</div>
                <div class="time-slot" data-value="6:30 م">6:30 م</div>
                <div class="time-slot" data-value="7:10 م">7:10 م</div>
                <div class="time-slot" data-value="7:50 م">7:50 م</div>
                <div class="time-slot" data-value="8:30 م">8:30 م</div>
                <div class="time-slot" data-value="9:10 م">9:10 م</div>
                <div class="time-slot" data-value="9:50 م">9:50 م</div>
              </div>
              <input type="hidden" id="evening-time" name="evening-time">
              <div class="error-message" id="evening-time-error" role="alert" aria-live="polite"></div>
            </div>
          </div>

          <!-- Doctor Selection (Hidden by default) -->
          <div id="doctor-selection" class="doctor-selection" aria-live="polite">
            <h3>
              <i class="fas fa-user-md"></i>
              اختيار الطبيب المعالج
            </h3>
            <p style="font-size: 0.9rem; color: var(--gray-text); margin-bottom: 15px;">
              <i class="fas fa-info-circle"></i>
              يمكنك اختيار أكثر من طبيب وسيتم تحديد الطبيب المتاح حسب الموعد المختار
            </p>
            
            <div class="doctor-grid" id="doctor-grid">
              <div class="doctor-card" data-value="د. أحمد محمد">
                <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-color);"></i>
                <h4>د. أحمد محمد</h4>
                <p>أخصائي العلاج الطبيعي</p>
              </div>
              <div class="doctor-card" data-value="د. سارة أحمد">
                <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 10px; color: var(--secondary-color);"></i>
                <h4>د. سارة أحمد</h4>
                <p>أخصائية العلاج الطبيعي</p>
              </div>
              <div class="doctor-card" data-value="د. محمد علي">
                <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-color);"></i>
                <h4>د. محمد علي</h4>
                <p>أخصائي العلاج الطبيعي</p>
              </div>
              <div class="doctor-card" data-value="د. فاطمة حسن">
                <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 10px; color: var(--secondary-color);"></i>
                <h4>د. فاطمة حسن</h4>
                <p>أخصائية العلاج الطبيعي</p>
              </div>
              <div class="doctor-card" data-value="د. عمر خالد">
                <i class="fas fa-user-md" style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-color);"></i>
                <h4>د. عمر خالد</h4>
                <p>أخصائي العلاج الطبيعي</p>
              </div>
              <div class="doctor-card" data-value="أي طبيب متاح">
                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; color: var(--accent-color);"></i>
                <h4>أي طبيب متاح</h4>
                <p>حسب التوفر</p>
              </div>
            </div>
            <input type="hidden" id="selected-doctors" name="selected-doctors">
          </div>

          <div class="form-group">
            <label for="notes">ملاحظات إضافية</label>
            <textarea 
              id="notes" 
              name="notes"
              rows="4" 
              placeholder="إذا كان لديك أي تفاصيل أخرى ترغب في توضيحها..."
              maxlength="500"
              aria-describedby="notes-counter"
            ></textarea>
            <div id="notes-counter" class="character-counter">0/500 حرف</div>
          </div>

          <h3>
            <i class="fas fa-upload"></i>
            رفع الملفات الطبية
          </h3>
          <p class="file-instructions">يمكنك رفع الملفات بصيغة PDF أو صور (JPG, PNG). الحد الأقصى لحجم الملف 5 ميجابايت.</p>
          
          <div class="file-grid">
            <div class="file-box">
              <label for="file-carnet">
                <img src="https://cdn-icons-png.flaticon.com/512/2910/2910791.png" alt="كارنيه التأمين" aria-hidden="true">
                كارنيه التأمين
              </label>
              <input 
                type="file" 
                id="file-carnet" 
                name="file-carnet"
                accept="image/*,.pdf"
                aria-describedby="carnet-help"
              >
              <div class="file-progress"></div>
              <div id="carnet-help" class="sr-only">رفع صورة كارنيه التأمين</div>
            </div>
            
            <div class="file-box">
              <label for="file-id">
                <img src="https://cdn-icons-png.flaticon.com/512/2910/2910768.png" alt="البطاقة الشخصية" aria-hidden="true">
                البطاقة الشخصية
              </label>
              <input 
                type="file" 
                id="file-id" 
                name="file-id"
                accept="image/*,.pdf"
                aria-describedby="id-help"
              >
              <div class="file-progress"></div>
              <div id="id-help" class="sr-only">رفع صورة البطاقة الشخصية</div>
            </div>
            
            <div class="file-box">
              <label for="file-prescription">
                <img src="https://cdn-icons-png.flaticon.com/512/2966/2966327.png" alt="الروشتة الطبية" aria-hidden="true">
                الروشتة الطبية
              </label>
              <input 
                type="file" 
                id="file-prescription" 
                name="file-prescription"
                accept="image/*,.pdf"
                aria-describedby="prescription-help"
              >
              <div class="file-progress"></div>
              <div id="prescription-help" class="sr-only">رفع صورة الروشتة الطبية</div>
            </div>
            
            <div class="file-box">
              <label for="file-approval">
                <img src="https://cdn-icons-png.flaticon.com/512/2910/2910814.png" alt="موافقة التأمين" aria-hidden="true">
                موافقة التأمين
              </label>
              <input 
                type="file" 
                id="file-approval" 
                name="file-approval"
                accept="image/*,.pdf"
                aria-describedby="approval-help"
              >
              <div class="file-progress"></div>
              <div id="approval-help" class="sr-only">رفع موافقة شركة التأمين</div>
            </div>
            
            <div class="file-box">
              <label for="file-xray1">
                <img src="https://cdn-icons-png.flaticon.com/512/2966/2966334.png" alt="تقرير أشعة" aria-hidden="true">
                تقرير أشعة
              </label>
              <input 
                type="file" 
                id="file-xray1" 
                name="file-xray1"
                accept="image/*,.pdf"
                aria-describedby="xray-help"
              >
              <div class="file-progress"></div>
              <div id="xray-help" class="sr-only">رفع تقرير الأشعة</div>
            </div>

            <div class="file-box">
              <label for="file-xray2">
                <img src="https://cdn-icons-png.flaticon.com/512/2966/2966334.png" alt="تقرير أشعة آخر" aria-hidden="true">
                تقرير أشعة آخر
              </label>
              <input 
                type="file" 
                id="file-xray2" 
                name="file-xray2"
                accept="image/*,.pdf"
                aria-describedby="xray2-help"
              >
              <div class="file-progress"></div>
              <div id="xray2-help" class="sr-only">رفع تقرير أشعة إضافي</div>
            </div>
            
            <div class="file-box">
              <label for="file-medical">
                <img src="https://cdn-icons-png.flaticon.com/512/2966/2966316.png" alt="تقرير طبي" aria-hidden="true">
                تقرير طبي
              </label>
              <input 
                type="file" 
                id="file-medical" 
                name="file-medical"
                accept="image/*,.pdf"
                aria-describedby="medical-help"
              >
              <div class="file-progress"></div>
              <div id="medical-help" class="sr-only">رفع التقرير الطبي</div>
            </div>
            
            <div class="file-box">
              <label for="file-other">
                <img src="https://cdn-icons-png.flaticon.com/512/2910/2910791.png" alt="ملفات أخرى" aria-hidden="true">
                ملفات أخرى
              </label>
              <input 
                type="file" 
                id="file-other" 
                name="file-other"
                accept="image/*,.pdf"
                aria-describedby="other-help"
              >
              <div class="file-progress"></div>
              <div id="other-help" class="sr-only">رفع ملفات أخرى</div>
            </div>
          </div>

          <!-- Service Rating -->
          <div class="form-group">
            <label>تقييم خدماتنا السابقة (اختياري)</label>
            <div class="rating-container">
              <div class="rating-stars" id="service-rating">
                <span class="star" data-rating="1">⭐</span>
                <span class="star" data-rating="2">⭐</span>
                <span class="star" data-rating="3">⭐</span>
                <span class="star" data-rating="4">⭐</span>
                <span class="star" data-rating="5">⭐</span>
              </div>
              <input type="hidden" id="rating" name="rating">
            </div>
          </div>

          <div class="submit-container">
            <button type="submit" id="submit-btn">
              <i class="fas fa-paper-plane"></i>
              تأكيد و إرسال الحجز
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Services Tab -->
    <div id="services" class="tab-content">
      <div class="container">
        <h2>
          <i class="fas fa-stethoscope"></i>
          خدماتنا الطبية
        </h2>
        
        <div class="services-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin: 30px 0;">
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-walking" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي للعظام والمفاصل</h3>
            <p>علاج شامل لمشاكل العظام والمفاصل والعمود الفقري باستخدام أحدث التقنيات والأجهزة المتطورة.</p>
          </div>
          
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-heartbeat" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي للقلب والأوعية الدموية</h3>
            <p>برامج تأهيل متخصصة لمرضى القلب والأوعية الدموية تحت إشراف طبي متخصص.</p>
          </div>
          
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-brain" style="font-size: 3rem; color: var(--accent-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي العصبي</h3>
            <p>علاج متخصص للحالات العصبية والسكتات الدماغية وإصابات الحبل الشوكي والشلل الدماغي.</p>
          </div>
          
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-child" style="font-size: 3rem; color: var(--warning-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي للأطفال</h3>
            <p>برامج علاجية مخصصة للأطفال لعلاج تأخر النمو الحركي والمشاكل التطورية والإعاقات الحركية.</p>
          </div>
          
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-dumbbell" style="font-size: 3rem; color: var(--info-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي الرياضي</h3>
            <p>علاج وتأهيل الإصابات الرياضية وبرامج الوقاية للرياضيين المحترفين والهواة.</p>
          </div>
          
          <div class="service-card" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium); text-align: center;">
            <i class="fas fa-female" style="font-size: 3rem; color: var(--error-color); margin-bottom: 20px;"></i>
            <h3>العلاج الطبيعي النسائي</h3>
            <p>برامج متخصصة للسيدات قبل وبعد الولادة وعلاج مشاكل قاع الحوض وسلس البول.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Branches Tab -->
    <div id="branches" class="tab-content">
      <div class="container">
        <h2>
          <i class="fas fa-map-marker-alt"></i>
          فروعنا
        </h2>
        
        <div id="map" class="map-container"></div>
        
        <div class="branches-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0;">
          <div class="branch-card" style="background: var(--white); padding: 25px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-building"></i>
              فرع إيدن مول - الشيخ زايد
            </h3>
            <p><i class="fas fa-map-marker-alt"></i> الشيخ زايد - إيدن مول - الدور الثاني</p>
            <p><i class="fas fa-phone"></i> 01012345678</p>
            <p><i class="fas fa-clock"></i> السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p><i class="fas fa-clock"></i> الجمعة: 2:00 م - 10:00 م</p>
          </div>
          
          <div class="branch-card" style="background: var(--white); padding: 25px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-building"></i>
              فرع أركان مول - الشيخ زايد
            </h3>
            <p><i class="fas fa-map-marker-alt"></i> الشيخ زايد - أركان مول - الدور الأول</p>
            <p><i class="fas fa-phone"></i> 01012345679</p>
            <p><i class="fas fa-clock"></i> السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p><i class="fas fa-clock"></i> الجمعة: 2:00 م - 10:00 م</p>
          </div>
          
          <div class="branch-card" style="background: var(--white); padding: 25px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-building"></i>
              فرع المعادي
            </h3>
            <p><i class="fas fa-map-marker-alt"></i> المعادي - شارع 9 - بجوار مترو المعادي</p>
            <p><i class="fas fa-phone"></i> 01012345680</p>
            <p><i class="fas fa-clock"></i> السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p><i class="fas fa-clock"></i> الجمعة: 2:00 م - 10:00 م</p>
          </div>
          
          <div class="branch-card" style="background: var(--white); padding: 25px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-building"></i>
              فرع المهندسين
            </h3>
            <p><i class="fas fa-map-marker-alt"></i> المهندسين - شارع السودان - أمام مترو البحوث</p>
            <p><i class="fas fa-phone"></i> 01012345681</p>
            <p><i class="fas fa-clock"></i> السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p><i class="fas fa-clock"></i> الجمعة: 2:00 م - 10:00 م</p>
          </div>
          
          <div class="branch-card" style="background: var(--white); padding: 25px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-building"></i>
              فرع التجمع الخامس
            </h3>
            <p><i class="fas fa-map-marker-alt"></i> التجمع الخامس - الحي الأول - شارع التسعين الشمالي</p>
            <p><i class="fas fa-phone"></i> 01012345682</p>
            <p><i class="fas fa-clock"></i> السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p><i class="fas fa-clock"></i> الجمعة: 2:00 م - 10:00 م</p>
          </div>
        </div>
      </div>
    </div>

    <!-- About Tab -->
    <div id="about" class="tab-content">
      <div class="container">
        <h2>
          <i class="fas fa-info-circle"></i>
          من نحن
        </h2>
        
        <div style="text-align: center; margin: 40px 0;">
          <img src="/public/eqq.jpg" alt="PhysioCare" style="border-radius: 12px; max-width: 100%; height: auto; max-height: 300px;">
        </div>
        
        <div style="font-size: 1.1rem; line-height: 1.8; text-align: justify;">
          <p>
            <strong>PhysioCare</strong> هو مركز متخصص في العلاج الطبيعي والتأهيل الطبي، تأسس عام 2015 بهدف تقديم خدمات طبية متميزة في مجال العلاج الطبيعي. نحن نؤمن بأن كل مريض يستحق أفضل رعاية طبية ممكنة، ولذلك نسعى دائماً لتطوير خدماتنا ومواكبة أحدث التطورات في مجال العلاج الطبيعي.
          </p>
          
          <h3>رؤيتنا</h3>
          <p>
            أن نكون الخيار الأول في مجال العلاج الطبيعي في مصر والشرق الأوسط، من خلال تقديم خدمات طبية عالية الجودة تساعد المرضى على استعادة صحتهم وحيويتهم والعودة إلى حياتهم الطبيعية بأفضل شكل ممكن.
          </p>
          
          <h3>مهمتنا</h3>
          <p>
            نسعى لتقديم خدمات علاج طبيعي شاملة ومتخصصة باستخدام أحدث الطرق العلاجية والتقنيات المتطورة، مع فريق طبي مؤهل وذو خبرة عالية لضمان أفضل النتائج العلاجية. كما نهتم بالتعليم المستمر لفريقنا الطبي ونشر الوعي الصحي في المجتمع.
          </p>
          
          <h3>قيمنا</h3>
          <ul style="list-style: none; padding: 0;">
            <li style="margin: 10px 0; padding: 10px; background: var(--light-bg); border-radius: 8px;">
              <i class="fas fa-heart" style="color: var(--error-color); margin-left: 10px;"></i>
              <strong>الرعاية المتميزة:</strong> نضع المريض في المقدمة ونهتم بكل التفاصيل لضمان راحته وشفائه
            </li>
            <li style="margin: 10px 0; padding: 10px; background: var(--light-bg); border-radius: 8px;">
              <i class="fas fa-star" style="color: var(--warning-color); margin-left: 10px;"></i>
              <strong>الجودة:</strong> نلتزم بأعلى معايير الجودة في جميع خدماتنا ونسعى للتحسين المستمر
            </li>
            <li style="margin: 10px 0; padding: 10px; background: var(--light-bg); border-radius: 8px;">
              <i class="fas fa-users" style="color: var(--primary-color); margin-left: 10px;"></i>
              <strong>العمل الجماعي:</strong> نعمل كفريق واحد متكامل لتحقيق أفضل النتائج للمرضى
            </li>
            <li style="margin: 10px 0; padding: 10px; background: var(--light-bg); border-radius: 8px;">
              <i class="fas fa-lightbulb" style="color: var(--secondary-color); margin-left: 10px;"></i>
              <strong>الابتكار:</strong> نواكب أحدث التطورات في مجال العلاج الطبيعي ونستخدم أحدث التقنيات
            </li>
          </ul>

          <h3>إنجازاتنا</h3>
          <p>
            خلال أكثر من 8 سنوات من العمل، تمكنا من علاج أكثر من 50,000 مريض بنجاح، وحصلنا على اعتماد وزارة الصحة المصرية وشهادات الجودة الدولية. كما نتعاون مع أكبر شركات التأمين في مصر لتوفير خدماتنا لأكبر عدد من المرضى.
          </p>
        </div>
      </div>
    </div>

    <!-- Contact Tab -->
    <div id="contact" class="tab-content">
      <div class="container">
        <h2>
          <i class="fas fa-phone"></i>
          تواصل معنا
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin: 30px 0;">
          <div class="contact-info" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>
              <i class="fas fa-map-marker-alt"></i>
              العنوان الرئيسي
            </h3>
            <p>الشيخ زايد - إيدن مول - الدور الثاني</p>
            
            <h3>
              <i class="fas fa-phone"></i>
              أرقام التواصل
            </h3>
            <p>الخط الساخن: 16123</p>
            <p>موبايل: 01012345678</p>
            <p>واتساب: 01012345678</p>
            
            <h3>
              <i class="fas fa-envelope"></i>
              البريد الإلكتروني
            </h3>
            <p>info@physiocare-eg.com</p>
            <p>support@physiocare-eg.com</p>
            
            <h3>
              <i class="fas fa-clock"></i>
              ساعات العمل
            </h3>
            <p>السبت - الخميس: 9:00 ص - 10:00 م</p>
            <p>الجمعة: 2:00 م - 10:00 م</p>
          </div>
          
          <div class="contact-form" style="background: var(--white); padding: 30px; border-radius: 12px; box-shadow: var(--shadow-medium);">
            <h3>أرسل لنا رسالة</h3>
            <form id="contact-form">
              <div class="form-group">
                <label for="contact-name">الاسم</label>
                <input type="text" id="contact-name" required>
              </div>
              
              <div class="form-group">
                <label for="contact-email">البريد الإلكتروني</label>
                <input type="email" id="contact-email" required>
              </div>
              
              <div class="form-group">
                <label for="contact-subject">الموضوع</label>
                <input type="text" id="contact-subject" required>
              </div>
              
              <div class="form-group">
                <label for="contact-message">الرسالة</label>
                <textarea id="contact-message" rows="5" required></textarea>
              </div>
              
              <button type="submit" style="background: var(--primary-color); color: var(--white); border: none; padding: 12px 30px; border-radius: 8px; cursor: pointer; width: 100%;">
                <i class="fas fa-paper-plane"></i>
                إرسال الرسالة
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Chat Bot -->
  <button class="chatbot-toggle" id="chatbot-toggle" aria-label="فتح المساعد الذكي">
    <i class="fas fa-comments"></i>
  </button>

  <div class="chatbot-container" id="chatbot-container">
    <div class="chatbot-header">
      <h4>
        <i class="fas fa-robot"></i>
        المساعد الذكي
      </h4>
      <button id="chatbot-close" style="background: none; border: none; color: var(--white); font-size: 1.2rem; cursor: pointer;">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="chatbot-messages" id="chatbot-messages">
      <div style="background: var(--light-bg); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
        مرحباً! كيف يمكنني مساعدتك اليوم؟
      </div>
    </div>
    <div class="chatbot-input">
      <input type="text" id="chatbot-input" placeholder="اكتب رسالتك هنا..." style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px;">
      <button id="chatbot-send" style="background: var(--primary-color); color: var(--white); border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer;">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <footer role="contentinfo">
    <div class="footer-content">
      <p>جميع الحقوق محفوظة &copy; PhysioCare 2025</p>
      <div class="footer-links">
        <a href="#privacy">سياسة الخصوصية</a>
        <a href="#terms">الشروط والأحكام</a>
        <a href="#careers">الوظائف</a>
        <a href="#blog">المدونة</a>
      </div>
      
      <div class="social-links">
        <a href="#" class="social-link" aria-label="فيسبوك">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" class="social-link" aria-label="تويتر">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="#" class="social-link" aria-label="إنستجرام">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="#" class="social-link" aria-label="لينكد إن">
          <i class="fab fa-linkedin-in"></i>
        </a>
        <a href="#" class="social-link" aria-label="يوتيوب">
          <i class="fab fa-youtube"></i>
        </a>
      </div>
      
      <p>للدعم الفني: <a href="tel:+201012345678">01012345678</a> | <a href="mailto:support@physiocare-eg.com">support@physiocare-eg.com</a></p>
    </div>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <!-- Leaflet JS for maps -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Enhanced JavaScript with all new features
    (function() {
      'use strict';

      // Configuration
      const CONFIG = {
        firebase: {
          apiKey: "AIzaSyA6_OACwpwaFSiX8jfsjS0_bt_EfIc4rhY",
          authDomain: "physiocare-booking.firebaseapp.com",
          projectId: "physiocare-booking",
          storageBucket: "physiocare-booking.firebasestorage.app",
          messagingSenderId: "815959251074",
          appId: "1:815959251074:web:cfd13396b4072b90ccbc9b",
          measurementId: "G-HBYJGQRVBB"
        },
        maxFileSize: 5 * 1024 * 1024, // 5MB
        allowedFileTypes: ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf'],
        debounceDelay: 300,
        maxRetries: 3
      };

      // Initialize Firebase
      let db, storage;
      try {
        firebase.initializeApp(CONFIG.firebase);
        db = firebase.firestore();
        storage = firebase.storage();
        console.log('Firebase initialized successfully');
      } catch (error) {
        console.error('Firebase initialization failed:', error);
        showMessage('خطأ في تهيئة النظام. يرجى إعادة تحميل الصفحة.', 'error');
      }

      // State management
      const state = {
        isSubmitting: false,
        uploadProgress: {},
        formData: {},
        validationErrors: {},
        currentTab: 'booking',
        selectedShift: null,
        selectedTimes: [],
        selectedDoctors: [],
        rating: 0
      };

      // Utility Functions
      const utils = {
        debounce(func, wait) {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        },

        sanitizeInput(input) {
          return input.trim().replace(/[<>]/g, '');
        },

        formatFileSize(bytes) {
          if (bytes === 0) return '0 Bytes';
          const k = 1024;
          const sizes = ['Bytes', 'KB', 'MB', 'GB'];
          const i = Math.floor(Math.log(bytes) / Math.log(k));
          return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },

        generateUniqueId() {
          return Date.now().toString(36) + Math.random().toString(36).substr(2);
        },

        async retry(fn, maxRetries = CONFIG.maxRetries) {
          for (let i = 0; i < maxRetries; i++) {
            try {
              return await fn();
            } catch (error) {
              if (i === maxRetries - 1) throw error;
              await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
            }
          }
        }
      };

      // Tab Navigation
      function setupTabNavigation() {
        const tabButtons = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            e.preventDefault();
            const targetTab = button.dataset.tab;

            // Update active states
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));

            button.classList.add('active');
            document.getElementById(targetTab).classList.add('active');

            state.currentTab = targetTab;

            // Initialize map if branches tab is selected
            if (targetTab === 'branches') {
              initializeMap();
            }
          });
        });
      }

      // Map initialization
      function initializeMap() {
        const mapContainer = document.getElementById('map');
        if (!mapContainer || mapContainer.hasChildNodes()) return;

        const map = L.map('map').setView([30.0444, 31.2357], 10); // Cairo coordinates

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Add branch markers
        const branches = [
          { name: 'إيدن مول', lat: 30.0444, lng: 31.2357 },
          { name: 'أركان مول', lat: 30.0544, lng: 31.2457 },
          { name: 'المعادي', lat: 29.9597, lng: 31.2584 },
          { name: 'المهندسين', lat: 30.0626, lng: 31.2497 },
          { name: 'التجمع الخامس', lat: 30.0131, lng: 31.4286 }
        ];

        branches.forEach(branch => {
          L.marker([branch.lat, branch.lng])
            .addTo(map)
            .bindPopup(`<strong>فرع ${branch.name}</strong>`);
        });
      }

      // Message system
      function showMessage(message, type = 'info', duration = 5000) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = message;
        messageDiv.setAttribute('role', type === 'error' ? 'alert' : 'status');
        messageDiv.setAttribute('aria-live', 'polite');

        document.body.appendChild(messageDiv);

        // Auto remove
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.style.animation = 'slideInRight 0.3s ease-out reverse';
            setTimeout(() => {
              if (messageDiv.parentNode) {
                messageDiv.remove();
              }
            }, 300);
          }
        }, duration);

        // Manual close on click
        messageDiv.addEventListener('click', () => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        });
      }

      // Validation functions
      const validators = {
        name(value) {
          const trimmed = value.trim();
          if (!trimmed) return 'الاسم مطلوب';
          if (trimmed.length < 6) return 'الاسم قصير جداً';
          if (trimmed.split(' ').length < 2) return 'يجب إدخال الاسم ثلاثي على الأقل';
          if (!/^[\u0600-\u06FF\s]+$/.test(trimmed)) return 'يجب أن يحتوي الاسم على أحرف عربية فقط';
          return null;
        },

        phone(value) {
          const trimmed = value.trim();
          if (!trimmed) return 'رقم الهاتف مطلوب';
          if (!/^01[0-2,5]{1}[0-9]{8}$/.test(trimmed)) {
            return 'رقم الهاتف غير صحيح. يجب أن يبدأ بـ 01 ويكون 11 رقم';
          }
          return null;
        },

        altPhone(value) {
          const trimmed = value.trim();
          if (!trimmed) return null; // Optional field
          return validators.phone(trimmed);
        },

        date(value) {
          if (!value) return 'التاريخ مطلوب';
          const selectedDate = new Date(value);
          const today = new Date();
          today.setHours(0, 0, 0, 0);

          if (selectedDate <= today) return 'لا يمكن حجز موعد في الماضي';

          const maxDate = new Date(today);
          maxDate.setMonth(today.getMonth() + 2);
          if (selectedDate > maxDate) return 'لا يمكن حجز موعد بعد شهرين من الآن';

          return null;
        },

        required(value, fieldName) {
          return value ? null : `${fieldName} مطلوب`;
        },

        file(file) {
          if (!file) return null; // Optional

          if (file.size > CONFIG.maxFileSize) {
            return `حجم الملف كبير جداً. الحد الأقصى ${utils.formatFileSize(CONFIG.maxFileSize)}`;
          }

          if (!CONFIG.allowedFileTypes.includes(file.type)) {
            return 'نوع الملف غير مدعوم. يرجى رفع صورة أو ملف PDF';
          }

          return null;
        }
      };

      // Form validation
      function validateField(fieldId, value, validator) {
        const errorElement = document.getElementById(`${fieldId}-error`);
        const successElement = document.getElementById(`${fieldId}-success`);
        const inputElement = document.getElementById(fieldId);

        const error = validator(value);

        if (error) {
          setFieldState(inputElement, errorElement, successElement, 'invalid', error);
          state.validationErrors[fieldId] = error;
          return false;
        } else {
          setFieldState(inputElement, errorElement, successElement, 'valid', 'تم التحقق بنجاح');
          delete state.validationErrors[fieldId];
          return true;
        }
      }

      function setFieldState(input, errorEl, successEl, state, message) {
        input.classList.remove('valid', 'invalid');
        input.classList.add(state);

        if (errorEl) {
          errorEl.textContent = state === 'invalid' ? message : '';
          errorEl.style.display = state === 'invalid' ? 'block' : 'none';
        }

        if (successEl) {
          successEl.textContent = state === 'valid' ? message : '';
          successEl.style.display = state === 'valid' ? 'block' : 'none';
        }
      }

      // Progress tracking
      function updateProgress() {
        const totalFields = 7; // Required fields count
        const completedFields = Object.keys(state.formData).filter(key => 
          state.formData[key] && !state.validationErrors[key]
        ).length;

        const progress = Math.min((completedFields / totalFields) * 100, 100);
        const progressFill = document.getElementById('progress-fill');
        if (progressFill) {
          progressFill.style.width = `${progress}%`;
        }
      }

      // Date constraints setup
      function setupDateConstraints() {
        const dateInput = document.getElementById('date');
        if (!dateInput) return;

        const today = new Date();
        const minDate = new Date(today);
        minDate.setDate(today.getDate() + 1); // Tomorrow

        const maxDate = new Date(today);
        maxDate.setMonth(today.getMonth() + 2); // 2 months from now

        dateInput.setAttribute('min', minDate.toISOString().split('T')[0]);
        dateInput.setAttribute('max', maxDate.toISOString().split('T')[0]);
      }

      // File upload handling
      function setupFileHandling() {
        const fileInputs = document.querySelectorAll('input[type="file"]');

        fileInputs.forEach(input => {
          input.addEventListener('change', handleFileChange);
          input.addEventListener('dragover', handleDragOver);
          input.addEventListener('drop', handleFileDrop);
        });
      }

      function handleFileChange(event) {
        const input = event.target;
        const file = input.files[0];
        const fileBox = input.closest('.file-box');
        const label = fileBox.querySelector('label');
        const progressBar = fileBox.querySelector('.file-progress');

        if (file) {
          const error = validators.file(file);
          if (error) {
            showMessage(error, 'error');
            input.value = '';
            return;
          }

          fileBox.classList.add('has-file');
          const fileName = file.name.length > 20 ? file.name.substring(0, 20) + '...' : file.name;
          const originalText = label.textContent.split('\n')[0];
          label.innerHTML = label.innerHTML.replace(originalText, `✓ ${fileName}`);

          // Simulate upload progress
          let progress = 0;
          const interval = setInterval(() => {
            progress += Math.random() * 30;
            if (progress >= 100) {
              progress = 100;
              clearInterval(interval);
            }
            progressBar.style.width = `${progress}%`;
          }, 100);
        } else {
          fileBox.classList.remove('has-file');
          progressBar.style.width = '0%';
        }
      }

      function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.closest('.file-box').style.borderColor = '#007BFF';
      }

      function handleFileDrop(event) {
        event.preventDefault();
        const fileBox = event.currentTarget.closest('.file-box');
        const input = fileBox.querySelector('input[type="file"]');
        fileBox.style.borderColor = '';

        if (event.dataTransfer.files.length > 0) {
          input.files = event.dataTransfer.files;
          handleFileChange({ target: input });
        }
      }

      // Choice button functionality
      function setupChoiceButtons() {
        setupPaymentTypeButtons();
        setupSingleChoice('branch-buttons', 'branch');
        setupSingleChoice('days-buttons', 'selected-days');
        setupSingleChoice('shift-buttons', 'shift');
        setupInsuranceButtons();
        setupTimeSlots();
        setupDoctorSelection();
        setupRatingSystem();
      }

      function setupPaymentTypeButtons() {
        const buttons = document.querySelectorAll('#payment-type-buttons .choice-button');
        const input = document.getElementById('payment-type');
        const insuranceOptions = document.getElementById('insurance-options');

        buttons.forEach(btn => {
          btn.addEventListener('click', () => {
            // Update ARIA states
            buttons.forEach(b => {
              b.classList.remove('active');
              b.setAttribute('aria-checked', 'false');
            });

            btn.classList.add('active');
            btn.setAttribute('aria-checked', 'true');
            input.value = btn.dataset.value;

            // Show/hide insurance options
            if (btn.dataset.value === 'تأمين') {
              insuranceOptions.style.display = 'block';
            } else {
              insuranceOptions.style.display = 'none';
              // Clear insurance selection
              document.getElementById('insurance').value = '';
              document.querySelectorAll('#insurance-buttons .choice-button').forEach(b => {
                b.classList.remove('active');
                b.setAttribute('aria-checked', 'false');
              });
            }

            state.formData['payment-type'] = btn.dataset.value;
            updateProgress();
          });
        });
      }

      function setupInsuranceButtons() {
        const buttons = document.querySelectorAll('#insurance-buttons .choice-button');
        const input = document.getElementById('insurance');

        buttons.forEach(btn => {
          btn.addEventListener('click', () => {
            // Update ARIA states
            buttons.forEach(b => {
              b.classList.remove('active');
              b.setAttribute('aria-checked', 'false');
            });

            btn.classList.add('active');
            btn.setAttribute('aria-checked', 'true');
            input.value = btn.dataset.value;

            state.formData['insurance'] = btn.dataset.value;
            updateProgress();
          });
        });
      }

      function setupSingleChoice(groupId, hiddenId) {
        const buttons = document.querySelectorAll(`#${groupId} .choice-button`);
        const input = document.getElementById(hiddenId);

        buttons.forEach(btn => {
          btn.addEventListener('click', () => {
            // Update ARIA states
            buttons.forEach(b => {
              b.classList.remove('active');
              b.setAttribute('aria-checked', 'false');
            });

            btn.classList.add('active');
            btn.setAttribute('aria-checked', 'true');
            input.value = btn.dataset.value;

            // Trigger validation
            state.formData[hiddenId] = btn.dataset.value;
            updateProgress();

            // Special handling for shift selection
            if (hiddenId === 'shift') {
              handleShiftChange(btn.dataset.value);
            }
          });

          // Keyboard support
          btn.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              btn.click();
            }
          });
        });
      }

      function setupTimeSlots() {
        // Morning time slots - allow multiple selection
        const morningSlots = document.querySelectorAll('#morning-time-slots .time-slot');
        const morningInput = document.getElementById('morning-time');

        morningSlots.forEach(slot => {
          slot.addEventListener('click', () => {
            slot.classList.toggle('active');

            // Get all selected morning times
            const selectedTimes = Array.from(document.querySelectorAll('#morning-time-slots .time-slot.active'))
              .map(s => s.dataset.value);

            morningInput.value = selectedTimes.join(', ');
            state.selectedTimes = selectedTimes;
          });
        });

        // Evening time slots - allow multiple selection
        const eveningSlots = document.querySelectorAll('#evening-time-slots .time-slot');
        const eveningInput = document.getElementById('evening-time');

        eveningSlots.forEach(slot => {
          slot.addEventListener('click', () => {
            slot.classList.toggle('active');

            // Get all selected evening times
            const selectedTimes = Array.from(document.querySelectorAll('#evening-time-slots .time-slot.active'))
              .map(s => s.dataset.value);

            eveningInput.value = selectedTimes.join(', ');
            state.selectedTimes = selectedTimes;
          });
        });
      }

      function setupDoctorSelection() {
        const doctorCards = document.querySelectorAll('.doctor-card');
        const selectedDoctorsInput = document.getElementById('selected-doctors');

        doctorCards.forEach(card => {
          card.addEventListener('click', () => {
            card.classList.toggle('selected');

            // Get all selected doctors
            const selectedDoctors = Array.from(document.querySelectorAll('.doctor-card.selected'))
              .map(c => c.dataset.value);

            selectedDoctorsInput.value = selectedDoctors.join(', ');
            state.selectedDoctors = selectedDoctors;
          });
        });
      }

      function setupRatingSystem() {
        const stars = document.querySelectorAll('.star');
        const ratingInput = document.getElementById('rating');

        stars.forEach((star, index) => {
          star.addEventListener('click', () => {
            const rating = index + 1;
            state.rating = rating;
            ratingInput.value = rating;

            stars.forEach((s, i) => {
              if (i < rating) {
                s.classList.add('active');
              } else {
                s.classList.remove('active');
              }
            });
          });

          star.addEventListener('mouseenter', () => {
            const rating = index + 1;
            stars.forEach((s, i) => {
              if (i < rating) {
                s.style.color = '#ffc107';
              } else {
                s.style.color = '#ddd';
              }
            });
          });
        });

        document.querySelector('.rating-stars').addEventListener('mouseleave', () => {
          stars.forEach((s, i) => {
            if (i < state.rating) {
              s.style.color = '#ffc107';
            } else {
              s.style.color = '#ddd';
            }
          });
        });
      }

      function handleShiftChange(shiftValue) {
        const morningOptions = document.getElementById('morning-options');
        const eveningOptions = document.getElementById('evening-options');
        const doctorSelection = document.getElementById('doctor-selection');

        if (shiftValue === 'صباحي') {
          morningOptions.style.display = 'block';
          morningOptions.setAttribute('aria-hidden', 'false');
          eveningOptions.style.display = 'none';
          eveningOptions.setAttribute('aria-hidden', 'true');
          doctorSelection.style.display = 'block';

          // Clear evening selections
          clearEveningSelections();
        } else if (shiftValue === 'مسائي') {
          eveningOptions.style.display = 'block';
          eveningOptions.setAttribute('aria-hidden', 'false');
          morningOptions.style.display = 'none';
          morningOptions.setAttribute('aria-hidden', 'true');
          doctorSelection.style.display = 'block';

          // Clear morning selections
          clearMorningSelections();
        }

        state.selectedShift = shiftValue;
      }

      function clearMorningSelections() {
        document.getElementById('morning-time').value = '';
        document.querySelectorAll('#morning-time-slots .time-slot').forEach(s => s.classList.remove('active'));
        state.selectedTimes = [];
      }

      function clearEveningSelections() {
        document.getElementById('evening-time').value = '';
        document.querySelectorAll('#evening-time-slots .time-slot').forEach(s => s.classList.remove('active'));
        state.selectedTimes = [];
      }

      // Input validation setup
      function setupInputValidation() {
        const validationRules = {
          'name': validators.name,
          'phone': validators.phone,
          'alt-phone': validators.altPhone,
          'date': validators.date
        };

        Object.entries(validationRules).forEach(([fieldId, validator]) => {
          const input = document.getElementById(fieldId);
          if (!input) return;

          const debouncedValidation = utils.debounce((value) => {
            validateField(fieldId, value, validator);
            state.formData[fieldId] = value;
            updateProgress();
          }, CONFIG.debounceDelay);

          input.addEventListener('input', (e) => {
            debouncedValidation(e.target.value);
          });

          input.addEventListener('blur', (e) => {
            validateField(fieldId, e.target.value, validator);
          });
        });

        // Character counter for notes
        const notesInput = document.getElementById('notes');
        const notesCounter = document.getElementById('notes-counter');

        if (notesInput && notesCounter) {
          notesInput.addEventListener('input', (e) => {
            const length = e.target.value.length;
            notesCounter.textContent = `${length}/500 حرف`;

            if (length > 450) {
              notesCounter.style.color = 'var(--warning-color)';
            } else {
              notesCounter.style.color = '';
            }
          });
        }
      }

      // Chat Bot functionality
      function setupChatBot() {
        const chatbotToggle = document.getElementById('chatbot-toggle');
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotClose = document.getElementById('chatbot-close');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSend = document.getElementById('chatbot-send');
        const chatbotMessages = document.getElementById('chatbot-messages');

        chatbotToggle.addEventListener('click', () => {
          chatbotContainer.style.display = 'flex';
          chatbotToggle.style.display = 'none';
          chatbotInput.focus();
        });

        chatbotClose.addEventListener('click', () => {
          chatbotContainer.style.display = 'none';
          chatbotToggle.style.display = 'block';
        });

        function sendMessage() {
          const message = chatbotInput.value.trim();
          if (!message) return;

          // Add user message
          const userMessage = document.createElement('div');
          userMessage.style.cssText = 'background: var(--primary-color); color: var(--white); padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: left;';
          userMessage.textContent = message;
          chatbotMessages.appendChild(userMessage);

          // Clear input
          chatbotInput.value = '';

          // Simulate bot response
          setTimeout(() => {
            const botResponse = getBotResponse(message);
            const botMessage = document.createElement('div');
            botMessage.style.cssText = 'background: var(--light-bg); padding: 10px; border-radius: 8px; margin-bottom: 10px;';
            botMessage.textContent = botResponse;
            chatbotMessages.appendChild(botMessage);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
          }, 1000);

          chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        chatbotSend.addEventListener('click', sendMessage);
        chatbotInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            sendMessage();
          }
        });

        function getBotResponse(message) {
          const responses = {
            'مرحبا': 'مرحباً بك في PhysioCare! كيف يمكنني مساعدتك؟',
            'حجز': 'يمكنك حجز موعد من خلال ملء النموذج أعلاه. هل تحتاج مساعدة في شيء معين؟',
            'أسعار': 'أسعارنا تختلف حسب نوع العلاج وشركة التأمين. يرجى الاتصال بنا للاستفسار عن الأسعار.',
            'مواعيد': 'نعمل من السبت للخميس من 9 صباحاً حتى 10 مساءً، والجمعة من 2 ظهراً حتى 10 مساءً.',
            'فروع': 'لدينا 5 فروع: إيدن مول، أركان مول، المعادي، المهندسين، والتجمع الخامس.',
            'تأمين': 'نتعامل مع جميع شركات التأمين الرئيسية في مصر.',
            'default': 'شكراً لك على تواصلك معنا. للمزيد من المساعدة، يرجى الاتصال بنا على 16123.'
          };

          for (const [key, response] of Object.entries(responses)) {
            if (message.includes(key)) {
              return response;
            }
          }

          return responses.default;
        }
      }

      // Contact form handling
      function setupContactForm() {
        const contactForm = document.getElementById('contact-form');
        if (!contactForm) return;

        contactForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const formData = new FormData(contactForm);
          const data = Object.fromEntries(formData);

          // Simulate sending message
          showMessage('تم إرسال رسالتك بنجاح! سنتواصل معك قريباً.', 'success');
          contactForm.reset();
        });
      }

      // Loading state management
      function setLoadingState(isLoading, message = 'جارٍ المعالجة...') {
        const btn = document.getElementById('submit-btn');
        const overlay = document.getElementById('loading-overlay');

        state.isSubmitting = isLoading;

        if (btn) {
          btn.disabled = isLoading;
          if (isLoading) {
            btn.innerHTML = `${message} <span class="spinner"></span>`;
          } else {
            btn.innerHTML = '<i class="fas fa-paper-plane"></i> تأكيد و إرسال الحجز';
          }
        }

        if (overlay) {
          overlay.style.display = isLoading ? 'flex' : 'none';
          overlay.setAttribute('aria-hidden', !isLoading);
        }
      }

      // File upload to Firebase
      async function uploadFile(file, path) {
        if (!file || !storage) return null;

        try {
          const ref = storage.ref(path);
          const uploadTask = ref.put(file);

          return new Promise((resolve, reject) => {
            uploadTask.on('state_changed',
              (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                // Update progress if needed
              },
              (error) => {
                console.error('Upload error:', error);
                reject(error);
              },
              async () => {
                try {
                  const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                  resolve(downloadURL);
                } catch (error) {
                  reject(error);
                }
              }
            );
          });
        } catch (error) {
          console.error('File upload failed:', error);
          throw new Error(`فشل في رفع الملف: ${error.message}`);
        }
      }

      // Form submission
      async function handleFormSubmission(event) {
        event.preventDefault();

        if (state.isSubmitting) return;

        try {
          setLoadingState(true, 'جارٍ التحقق من البيانات...');

          // Collect and validate all form data
          const formData = collectFormData();
          const validationResult = validateFormData(formData);

          if (!validationResult.isValid) {
            showMessage('يرجى تصحيح الأخطاء المذكورة أعلاه', 'error');
            setLoadingState(false);
            return;
          }

          // Upload files
          setLoadingState(true, 'جارٍ رفع الملفات...');
          const uploadedFiles = await uploadFiles(formData);

          // Save to database
          setLoadingState(true, 'جارٍ حفظ البيانات...');
          const bookingData = {
            ...formData,
            files: uploadedFiles,
            selectedTimes: state.selectedTimes,
            selectedDoctors: state.selectedDoctors,
            rating: state.rating,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            status: 'pending',
            id: utils.generateUniqueId()
          };

          await utils.retry(async () => {
            await db.collection('bookings').add(bookingData);
          });

          // Send WhatsApp confirmation
          sendWhatsAppConfirmation(formData);

          // Success feedback
          showMessage('✅ تم إرسال الحجز بنجاح! سيتم التواصل معكم للتأكيد', 'success', 8000);

          // Reset form
          resetForm();

        } catch (error) {
          console.error('Submission error:', error);
          showMessage(`حدث خطأ: ${error.message || 'يرجى المحاولة مرة أخرى'}`, 'error');
        } finally {
          setLoadingState(false);
        }
      }

      function collectFormData() {
        return {
          name: utils.sanitizeInput(document.getElementById('name').value),
          phone: utils.sanitizeInput(document.getElementById('phone').value),
          altPhone: utils.sanitizeInput(document.getElementById('alt-phone').value),
          paymentType: document.getElementById('payment-type').value,
          insurance: document.getElementById('insurance').value,
          branch: document.getElementById('branch').value,
          date: document.getElementById('date').value,
          selectedDays: document.getElementById('selected-days').value,
          shift: document.getElementById('shift').value,
          morningTime: document.getElementById('morning-time').value,
          eveningTime: document.getElementById('evening-time').value,
          selectedDoctors: document.getElementById('selected-doctors').value,
          notes: utils.sanitizeInput(document.getElementById('notes').value),
          files: {
            carnet: document.getElementById('file-carnet').files[0],
            id: document.getElementById('file-id').files[0],
            prescription: document.getElementById('file-prescription').files[0],
            approval: document.getElementById('file-approval').files[0],
            xray1: document.getElementById('file-xray1').files[0],
            xray2: document.getElementById('file-xray2').files[0],
            medical: document.getElementById('file-medical').files[0],
            other: document.getElementById('file-other').files[0]
          }
        };
      }

      function validateFormData(data) {
        const errors = [];

        // Required field validation
        if (!validators.name(data.name)) errors.push('الاسم');
        if (!validators.phone(data.phone)) errors.push('رقم الهاتف');
        if (!data.paymentType) errors.push('نوع الدفع');
        if (data.paymentType === 'تأمين' && !data.insurance) errors.push('شركة التأمين');
        if (!data.branch) errors.push('الفرع');
        if (!validators.date(data.date)) errors.push('التاريخ');
        if (!data.selectedDays) errors.push('الأيام');
        if (!data.shift) errors.push('الشيفت');

        // Shift-specific validation
        if (data.shift === 'صباحي') {
          if (!data.morningTime) errors.push('الموعد الصباحي');
        } else if (data.shift === 'مسائي') {
          if (!data.eveningTime) errors.push('الموعد المسائي');
        }

        // File validation
        Object.values(data.files).forEach(file => {
          if (file) {
            const fileError = validators.file(file);
            if (fileError) errors.push(fileError);
          }
        });

        return {
          isValid: errors.length === 0,
          errors
        };
      }

      async function uploadFiles(formData) {
        const uploadedFiles = {};
        const uploadPromises = [];

        Object.entries(formData.files).forEach(([key, file]) => {
          if (file) {
            const uniqueId = `${formData.name.replace(/\s/g, '_')}_${Date.now()}`;
            const path = `bookings/${uniqueId}/${key}_${file.name}`;

            uploadPromises.push(
              uploadFile(file, path).then(url => {
                if (url) uploadedFiles[key] = url;
              })
            );
          }
        });

        await Promise.all(uploadPromises);
        return uploadedFiles;
      }

      function sendWhatsAppConfirmation(data) {
        try {
          let message = `تم استلام طلب حجز جلستكم في PhysioCare بنجاح ✅

الاسم: ${data.name}
الفرع: ${data.branch}
التاريخ: ${data.date}
الأيام: ${data.selectedDays}
الشيفت: ${data.shift}`;

          if (data.shift === 'صباحي' && data.morningTime) {
            message += `\nالمواعيد المفضلة: ${data.morningTime}`;
          } else if (data.shift === 'مسائي' && data.eveningTime) {
            message += `\nالمواعيد المفضلة: ${data.eveningTime}`;
          }

          if (data.selectedDoctors) {
            message += `\nالأطباء المفضلون: ${data.selectedDoctors}`;
          }

          message += `\n\nسوف يتم التواصل معكم للتأكيد النهائي.\nشكراً لثقتكم في PhysioCare 🏥`;

          const cleanPhone = data.phone.replace(/^0/, '');
          if (cleanPhone.length === 10) {
            const whatsappUrl = `https://wa.me/2${cleanPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank', 'noopener,noreferrer');
          }
        } catch (error) {
          console.error('WhatsApp error:', error);
          // Don't show error to user as this is not critical
        }
      }

      function resetForm() {
        const form = document.getElementById('booking-form');
        if (form) {
          form.reset();
        }

        // Reset choice buttons
        document.querySelectorAll('.choice-button.active').forEach(btn => {
          btn.classList.remove('active');
          btn.setAttribute('aria-checked', 'false');
        });

        // Reset time slots
        document.querySelectorAll('.time-slot.active').forEach(slot => {
          slot.classList.remove('active');
        });

        // Reset doctor cards
        document.querySelectorAll('.doctor-card.selected').forEach(card => {
          card.classList.remove('selected');
        });

        // Reset file boxes
        document.querySelectorAll('.file-box.has-file').forEach(box => {
          box.classList.remove('has-file');
          const progress = box.querySelector('.file-progress');
          if (progress) progress.style.width = '0%';
        });

        // Reset validation states
        document.querySelectorAll('input.valid, input.invalid').forEach(input => {
          input.classList.remove('valid', 'invalid');
        });

        document.querySelectorAll('.error-message, .success-message').forEach(msg => {
          msg.style.display = 'none';
        });

        // Hide options
        document.getElementById('morning-options').style.display = 'none';
        document.getElementById('evening-options').style.display = 'none';
        document.getElementById('insurance-options').style.display = 'none';
        document.getElementById('doctor-selection').style.display = 'none';

        // Reset rating
        document.querySelectorAll('.star').forEach(star => {
          star.classList.remove('active');
          star.style.color = '#ddd';
        });

        // Reset progress
        const progressFill = document.getElementById('progress-fill');
        if (progressFill) {
          progressFill.style.width = '0%';
        }

        // Reset state
        state.formData = {};
        state.validationErrors = {};
        state.selectedShift = null;
        state.selectedTimes = [];
        state.selectedDoctors = [];
        state.rating = 0;
      }

      // Keyboard navigation
      function setupKeyboardNavigation() {
        document.addEventListener('keydown', (e) => {
          // Escape key to close messages and chatbot
          if (e.key === 'Escape') {
            document.querySelectorAll('.message').forEach(msg => msg.remove());
            const chatbot = document.getElementById('chatbot-container');
            if (chatbot.style.display === 'flex') {
              document.getElementById('chatbot-close').click();
            }
          }

          // Enter key on choice buttons
          if (e.key === 'Enter' && e.target.classList.contains('choice-button')) {
            e.preventDefault();
            e.target.click();
          }

          // Tab navigation for accessibility
          if (e.key === 'Tab') {
            // Let browser handle tab navigation
          }
        });
      }

      // Error boundary
      function setupErrorHandling() {
        window.addEventListener('error', (event) => {
          console.error('Global error:', event.error);
          showMessage('حدث خطأ غير متوقع. يرجى إعادة تحميل الصفحة.', 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
          console.error('Unhandled promise rejection:', event.reason);
          showMessage('حدث خطأ في النظام. يرجى المحاولة مرة أخرى.', 'error');
        });
      }

      // Performance monitoring
      function setupPerformanceMonitoring() {
        if ('performance' in window) {
          window.addEventListener('load', () => {
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            console.log(`Page load time: ${loadTime}ms`);

            if (loadTime > 3000) {
              console.warn('Slow page load detected');
            }
          });
        }
      }

      // Service Worker for offline functionality
      function setupServiceWorker() {
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => {
                console.log('SW registered: ', registration);
              })
              .catch(registrationError => {
                console.log('SW registration failed: ', registrationError);
              });
          });
        }
      }

      // Analytics tracking
      function setupAnalytics() {
        // Track form interactions
        document.addEventListener('click', (e) => {
          if (e.target.classList.contains('choice-button')) {
            console.log('Choice button clicked:', e.target.textContent);
          }

          if (e.target.classList.contains('nav-tab')) {
            console.log('Tab switched:', e.target.dataset.tab);
          }
        });

        // Track form submission
        document.getElementById('booking-form').addEventListener('submit', () => {
          console.log('Booking form submitted');
        });
      }

      // Initialize everything when DOM is ready
      function initialize() {
        try {
          setupTabNavigation();
          setupDateConstraints();
          setupFileHandling();
          setupChoiceButtons();
          setupInputValidation();
          setupChatBot();
          setupContactForm();
          setupKeyboardNavigation();
          setupErrorHandling();
          setupPerformanceMonitoring();
          setupServiceWorker();
          setupAnalytics();

          // Form submission
          const form = document.getElementById('booking-form');
          if (form) {
            form.addEventListener('submit', handleFormSubmission);
          }

          // Welcome message
          setTimeout(() => {
            showMessage('مرحباً بكم في PhysioCare! نحن هنا لخدمتكم على مدار الساعة', 'info');
          }, 1000);

          console.log('Enhanced PhysioCare application initialized successfully');
        } catch (error) {
          console.error('Initialization error:', error);
          showMessage('حدث خطأ في تحميل النظام. يرجى إعادة تحميل الصفحة.', 'error');
        }
      }

      // Start the application
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
      } else {
        initialize();
      }

    })();
  </script>
</body>
</html>
