<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>PhysioCare - جدول المواعيد</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <style>
    body { background-color: #f2f7ff; font-family: 'Cairo', sans-serif; direction: rtl; text-align: right; }
    .shift-title { font-size: 1.5rem; font-weight: bold; margin-top: 30px; color: #195190; }
    .table thead th { background-color: #195190; color: white; }
    .table td, .table th { vertical-align: middle; text-align: center; }
    .available-btn { background-color: #28a745; color: white; padding: 5px 10px; border: none; border-radius: 5px; }
    .available-btn:hover { background-color: #218838; }
  </style>
</head>
<body class="container py-4">

  <h1 class="text-center text-primary mb-4">مركز PhysioCare للعلاج الطبيعي</h1>

  <div class="shift-title">الشيفت الصباحي (السبت، الإثنين، الأربعاء)</div>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>الوقت</th>
        <th>دكتور 1</th>
        <th>دكتور 2</th>
        <th>دكتور 3</th>
        <th>دكتور 4</th>
        <th>دكتور 5</th>
        <th>دكتور 6</th>
        <th>دكتور 7</th>
        <th>دكتور 8</th>
        <th>دكتور 9</th>
        <th>دكتور 10</th>
      </tr>
    </thead>
    <tbody id="morning-shift">
      <!-- يتم ملء الصفوف بالجافاسكريبت -->
    </tbody>
  </table>

  <div class="shift-title">الشيفت المسائي (الأحد، الثلاثاء، الخميس)</div>
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>الوقت</th>
        <th>دكتور 1</th>
        <th>دكتور 2</th>
        <th>دكتور 3</th>
        <th>دكتور 4</th>
        <th>دكتور 5</th>
        <th>دكتور 6</th>
        <th>دكتور 7</th>
        <th>دكتور 8</th>
        <th>دكتور 9</th>
        <th>دكتور 10</th>
      </tr>
    </thead>
    <tbody id="evening-shift">
      <!-- يتم ملء الصفوف بالجافاسكريبت -->
    </tbody>
  </table>

  <!-- Modal للحجز -->
  <div class="modal fade" id="bookingModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="bookingForm">
          <div class="modal-header">
            <h5 class="modal-title">حجز الموعد</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="hidden" id="booking-time">
            <input type="hidden" id="booking-doctor">
            <input type="hidden" id="booking-shift">

            <div class="mb-3">
              <label>الاسم</label>
              <input type="text" class="form-control" id="name" required>
            </div>
            <div class="mb-3">
              <label>رقم الهاتف</label>
              <input type="text" class="form-control" id="phone" required>
            </div>
            <div class="mb-3">
              <label>شركة التأمين</label>
              <input type="text" class="form-control" id="insurance">
            </div>
            <div class="mb-3">
              <label>تحميل الملفات</label>
              <input type="file" class="form-control" id="files" multiple>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">تأكيد الحجز</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // بيانات Firebase – استبدل بمشروعك الحقيقي
    const firebaseConfig = {
      apiKey: "XXX",
      authDomain: "XXX.firebaseapp.com",
      projectId: "XXX",
      storageBucket: "XXX.appspot.com",
      messagingSenderId: "XXX",
      appId: "XXX"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // توليد الأوقات لكل شيفت
    function generateTimes(startHour = 10.5, sessions = 9) {
      const times = [];
      for (let i = 0; i < sessions; i++) {
        let totalMinutes = startHour * 60 + i * 40;
        let h = Math.floor(totalMinutes / 60);
        let m = totalMinutes % 60;
        let ampm = h >= 12 ? 'م' : 'ص';
        if (h > 12) h -= 12;
        times.push(`${h}:${m.toString().padStart(2, '0')} ${ampm}`);
      }
      return times;
    }

    function fillShiftTable(id, shiftName) {
      const times = generateTimes();
      const table = document.getElementById(id);
      times.forEach(time => {
        const row = document.createElement('tr');
        const timeCell = document.createElement('td');
        timeCell.textContent = time;
        row.appendChild(timeCell);
        for (let i = 1; i <= 10; i++) {
          const cell = document.createElement('td');
          const btn = document.createElement('button');
          btn.className = "available-btn";
          btn.textContent = "متاح";
          btn.onclick = () => openModal(time, `دكتور ${i}`, shiftName);
          cell.appendChild(btn);
          row.appendChild(cell);
        }
        table.appendChild(row);
      });
    }

    function openModal(time, doctor, shift) {
      document.getElementById('booking-time').value = time;
      document.getElementById('booking-doctor').value = doctor;
      document.getElementById('booking-shift').value = shift;
      const modal = new bootstrap.Modal(document.getElementById('bookingModal'));
      modal.show();
    }

    // عند إرسال الفورم
    document.getElementById('bookingForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const insurance = document.getElementById('insurance').value;
      const doctor = document.getElementById('booking-doctor').value;
      const time = document.getElementById('booking-time').value;
      const shift = document.getElementById('booking-shift').value;
      const files = document.getElementById('files').files;

      const bookingData = {
        name, phone, insurance, doctor, time, shift, createdAt: new Date()
      };

      const docRef = await db.collection("bookings").add(bookingData);

      // رفع الملفات
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const storageRef = storage.ref().child(`uploads/${docRef.id}/${file.name}`);
        await storageRef.put(file);
      }

      alert("تم الحجز بنجاح");
      document.getElementById('bookingForm').reset();
      bootstrap.Modal.getInstance(document.getElementById('bookingModal')).hide();
    });

    fillShiftTable("morning-shift", "صباحي");
    fillShiftTable("evening-shift", "مسائي");
  </script>

</body>
</html>
