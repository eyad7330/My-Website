<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="احجز جلسة العلاج الطبيعي في PhysioCare - أفضل مراكز العلاج الطبيعي في مصر" />
  <meta name="keywords" content="علاج طبيعي, حجز جلسة, PhysioCare, العلاج الطبيعي, مصر" />
  <meta name="author" content="PhysioCare" />
  <meta name="robots" content="index, follow" />
  <meta property="og:title" content="PhysioCare - حجز جلسة علاج طبيعي" />
  <meta property="og:description" content="احجز جلستك العلاجية بسهولة وأمان مع أفضل أطباء العلاج الطبيعي" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://physiocare.com" />
  <meta property="og:image" content="https://physiocare.com/images/logo.png" />
  <meta name="twitter:card" content="summary_large_image" />
  
  <title>PhysioCare | حجز جلسة علاج طبيعي</title>
  
  <!-- Preconnect to external domains for performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="preconnect" href="https://cdn-icons-png.flaticon.com">
  <link rel="preconnect" href="https://unpkg.com">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS for maps -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  
  <style>
    /* CSS Custom Properties for better maintainability */
    :root {
      --primary-color: #005f73;
      --primary-light: #0a9396;
      --secondary-color: #009688;
      --secondary-light: #1cc7a8;
      --accent-color: #94d2bd;
      --success-color: #28a745;
      --error-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
      --light-bg: #f8f9fa;
      --white: #ffffff;
      --dark-text: #343a40;
      --gray-text: #6c757d;
      --border-color: #ced4da;
      --border-light: #e9ecef;
      --shadow-light: 0 2px 4px rgba(0,0,0,0.04);
      --shadow-medium: 0 4px 8px rgba(0,0,0,0.08);
      --shadow-heavy: 0 10px 30px rgba(0,0,0,0.08);
      --border-radius: 8px;
      --border-radius-large: 16px;
      --transition: all 0.3s ease;
      --font-family: 'Cairo', sans-serif;
      --max-width: 900px;
    }

    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: var(--font-family);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark-text);
      direction: rtl;
      line-height: 1.6;
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }

    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 6px;
      background: var(--primary-color);
      color: var(--white);
      padding: 8px;
      text-decoration: none;
      border-radius: var(--border-radius);
      z-index: 1000;
    }

    .skip-link:focus {
      top: 6px;
    }

    /* Header */
    header {
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
      padding: 40px 20px;
      text-align: center;
      color: var(--white);
      box-shadow: var(--shadow-heavy);
      border-bottom: 4px solid var(--accent-color);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.1;
      pointer-events: none;
    }

    .header-content {
      position: relative;
      z-index: 2;
    }

    header h1 {
      margin: 0;
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      letter-spacing: 1px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .logo-icon {
      font-size: 2.5rem;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    header p {
      margin: 10px 0 0;
      font-size: clamp(1rem, 3vw, 1.2rem);
      font-weight: 400;
      opacity: 0.95;
    }

    /* Navigation */
    .nav-tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 24px;
      background: var(--white);
      border: 2px solid var(--border-light);
      border-radius: 25px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      color: var(--gray-text);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-tab:hover {
      background: var(--primary-color);
      color: var(--white);
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .nav-tab.active {
      background: var(--primary-color);
      color: var(--white);
      border-color: var(--primary-color);
    }

    /* Main Container */
    .container {
      max-width: var(--max-width);
      background: var(--white);
      margin: 30px auto;
      padding: 40px;
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-heavy);
      border-top: 5px solid var(--secondary-color);
      position: relative;
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading overlay */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: var(--white);
      animation: spin 1s ease-in-out infinite;
    }

    /* Typography */
    h2 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    h3 {
      text-align: center;
      color: var(--primary-color);
      margin-top: 40px;
      margin-bottom: 20px;
      border-top: 1px solid var(--border-light);
      padding-top: 30px;
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      font-weight: 600;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 25px;
      position: relative;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    label {
      display: block;
      margin: 0 0 8px;
      font-weight: 700;
      color: var(--gray-text);
      font-size: 1.1rem;
      cursor: pointer;
    }

    .required::after {
      content: ' *';
      color: var(--error-color);
      font-weight: bold;
    }

    input[type="text"],
    input[type="tel"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 15px;
      border: 2px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-family: var(--font-family);
      background-color: #fdfdff;
      transition: var(--transition);
      box-sizing: border-box;
      outline: none;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: #007BFF;
      background-color: var(--white);
      box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.1);
      transform: translateY(-1px);
    }

    /* Input validation styles */
    input.invalid,
    textarea.invalid,
    select.invalid {
      border-color: var(--error-color);
      background-color: #fff5f5;
      animation: shake 0.5s ease-in-out;
    }

    input.valid,
    textarea.valid,
    select.valid {
      border-color: var(--success-color);
      background-color: #f8fff8;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .error-message {
      color: var(--error-color);
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
      font-weight: 600;
      animation: fadeIn 0.3s ease-in-out;
    }

    .success-message {
      color: var(--success-color);
      font-size: 0.9rem;
      margin-top: 5px;
      display: none;
      font-weight: 600;
      animation: fadeIn 0.3s ease-in-out;
    }

    textarea {
      resize: vertical;
      min-height: 120px;
    }

    /* Choice Buttons */
    .choice-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      gap: 12px;
      margin: 10px 0 25px;
    }

    .choice-button {
      padding: 12px 25px;
      border: 2px solid var(--border-light);
      background: var(--light-bg);
      color: var(--gray-text);
      font-size: 1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 700;
      box-shadow: var(--shadow-light);
      position: relative;
      overflow: hidden;
      min-width: 120px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .choice-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .choice-button:hover::before {
      left: 100%;
    }

    .choice-button:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
      border-color: #007BFF;
      color: #007BFF;
    }

    .choice-button:focus {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }

    .choice-button.active {
      background: linear-gradient(135deg, #007BFF, #0056b3);
      color: var(--white);
      border-color: #0056b3;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
      transform: translateY(-2px);
    }

    .choice-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* Time slots grid */
    .time-slots {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin: 15px 0;
    }

    .time-slot {
      padding: 15px 10px;
      border: 2px solid var(--border-light);
      background: var(--white);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      position: relative;
    }

    .time-slot:hover {
      border-color: var(--secondary-color);
      background: var(--light-bg);
      transform: translateY(-2px);
    }

    .time-slot.active {
      background: var(--secondary-color);
      color: var(--white);
      border-color: var(--secondary-color);
    }

    .time-slot.unavailable {
      background: #f8f9fa;
      color: #6c757d;
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* File Upload Section */
    .file-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .file-box {
      position: relative;
      border: 2px dashed var(--border-color);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      background-color: #fdfdff;
      transition: var(--transition);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 140px;
      overflow: hidden;
    }

    .file-box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(0,123,255,0.05) 50%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .file-box:hover::before {
      opacity: 1;
    }

    .file-box:hover {
      border-color: #007BFF;
      background-color: #f8faff;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 123, 255, 0.15);
    }

    .file-box:focus-within {
      outline: 2px solid #007BFF;
      outline-offset: 2px;
    }

    .file-box label {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--gray-text);
      margin: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
      position: relative;
      z-index: 2;
    }

    .file-box .icon, 
    .file-box img {
      font-size: 2.5rem;
      line-height: 1;
      filter: grayscale(50%);
      transition: var(--transition);
    }

    .file-box:hover .icon, 
    .file-box:hover img {
      filter: grayscale(0%);
      transform: scale(1.1);
    }

    .file-box img {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .file-box input[type="file"] {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
      z-index: 1;
    }

    .file-box.has-file {
      border-color: var(--success-color);
      background-color: #f8fff8;
      border-style: solid;
    }

    .file-box.has-file .icon {
      color: var(--success-color);
    }

    .file-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 4px;
      background: var(--success-color);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 0 0 12px 12px;
    }

    /* Submit Button */
    .submit-container {
      margin-top: 40px;
      text-align: center;
    }

    button[type="submit"] {
      background: linear-gradient(135deg, var(--secondary-light) 0%, var(--secondary-color) 100%);
      color: var(--white);
      border: none;
      padding: 18px 40px;
      width: 100%;
      max-width: 400px;
      font-size: 1.2rem;
      font-weight: 700;
      font-family: var(--font-family);
      border-radius: 12px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 5px 20px rgba(0, 150, 136, 0.3);
      position: relative;
      overflow: hidden;
    }

    button[type="submit"]::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }

    button[type="submit"]:hover:not(:disabled)::before {
      left: 100%;
    }

    button[type="submit"]:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 150, 136, 0.4);
    }

    button[type="submit"]:disabled {
      background: var(--gray-text);
      cursor: not-allowed;
      box-shadow: none;
      opacity: 0.7;
    }

    /* Message Display */
    .message-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      width: 90%;
      max-width: 400px;
    }

    .message {
      padding: 15px 20px;
      border-radius: var(--border-radius);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-medium);
      animation: slideIn 0.5s forwards, fadeOut 0.5s forwards 5s;
    }

    .message.info {
      background-color: var(--info-color);
      color: var(--white);
    }

    .message.success {
      background-color: var(--success-color);
      color: var(--white);
    }

    .message.error {
      background-color: var(--error-color);
      color: var(--white);
    }

    .message .icon {
      font-size: 1.5rem;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; display: none; }
    }

    /* Contact Info Section */
    .contact-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
    }

    .contact-item {
      background: var(--light-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-light);
      text-align: center;
      transition: var(--transition);
    }

    .contact-item:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-medium);
    }

    .contact-item .icon {
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 10px;
    }

    .contact-item h4 {
      margin: 0 0 8px;
      color: var(--primary-color);
      font-size: 1.2rem;
    }

    .contact-item p {
      margin: 0;
      color: var(--gray-text);
      font-size: 0.95rem;
    }

    .contact-item a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 600;
    }

    .contact-item a:hover {
      text-decoration: underline;
    }

    /* Map Section */
    #map {
      height: 400px;
      width: 100%;
      border-radius: var(--border-radius);
      margin-top: 30px;
      box-shadow: var(--shadow-medium);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 30px 20px;
      margin-top: 50px;
      background: var(--primary-color);
      color: var(--white);
      font-size: 0.9rem;
      box-shadow: var(--shadow-heavy);
    }

    footer p {
      margin: 0;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      .container {
        margin: 20px auto;
        padding: 25px;
      }

      .nav-tab {
        padding: 10px 18px;
        font-size: 0.9rem;
      }

      h2 {
        font-size: 1.8rem;
      }

      .contact-info {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .nav-tabs {
        flex-direction: column;
        align-items: center;
      }

      .nav-tab {
        width: 90%;
        margin-bottom: 10px;
      }

      button[type="submit"] {
        padding: 15px 30px;
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
  </div>

  <div class="message-container" id="message-container"></div>

  <header>
    <div class="header-content">
      <h1><i class="fas fa-hand-holding-medical"></i> PhysioCare</h1>
      <p>نقدم لك أفضل رعاية علاج طبيعي في مصر</p>
    </div>
  </header>

  <main id="main-content">
    <div class="container">
      <div class="nav-tabs">
        <a href="#booking" class="nav-tab active" data-tab="booking">
          <i class="fas fa-calendar-alt"></i> حجز جلسة
        </a>
        <a href="#about" class="nav-tab" data-tab="about">
          <i class="fas fa-info-circle"></i> عن PhysioCare
        </a>
        <a href="#contact" class="nav-tab" data-tab="contact">
          <i class="fas fa-phone-alt"></i> اتصل بنا
        </a>
      </div>

      <div id="booking" class="tab-content active">
        <h2><i class="fas fa-calendar-check"></i> حجز جلسة علاج طبيعي</h2>
        <form id="booking-form">
          <div class="form-row">
            <div class="form-group">
              <label for="name" class="required">الاسم بالكامل</label>
              <input type="text" id="name" name="name" placeholder="أدخل اسمك بالكامل" required aria-describedby="name-error">
              <div class="error-message" id="name-error">الرجاء إدخال الاسم بالكامل.</div>
            </div>
            <div class="form-group">
              <label for="phone" class="required">رقم الهاتف</label>
              <input type="tel" id="phone" name="phone" placeholder="مثال: 01XXXXXXXXX" required aria-describedby="phone-error">
              <div class="error-message" id="phone-error">الرجاء إدخال رقم هاتف صحيح (11 رقم).</div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="email">البريد الإلكتروني (اختياري)</label>
              <input type="email" id="email" name="email" placeholder="أدخل بريدك الإلكتروني" aria-describedby="email-error">
              <div class="error-message" id="email-error">الرجاء إدخال بريد إلكتروني صحيح.</div>
            </div>
            <div class="form-group">
              <label for="alt-phone">رقم هاتف بديل (اختياري)</label>
              <input type="tel" id="alt-phone" name="alt-phone" placeholder="مثال: 01XXXXXXXXX" aria-describedby="alt-phone-error">
              <div class="error-message" id="alt-phone-error">الرجاء إدخال رقم هاتف صحيح (11 رقم).</div>
            </div>
          </div>

          <div class="form-group">
            <label for="service" class="required">نوع الجلسة</label>
            <select id="service" name="service" required aria-describedby="service-error">
              <option value="">اختر نوع الجلسة</option>
              <option value="جلسة علاج طبيعي عام">جلسة علاج طبيعي عام</option>
              <option value="علاج طبيعي للإصابات الرياضية">علاج طبيعي للإصابات الرياضية</option>
              <option value="علاج طبيعي لكبار السن">علاج طبيعي لكبار السن</option>
              <option value="علاج طبيعي للأطفال">علاج طبيعي للأطفال</option>
              <option value="تأهيل بعد الجراحة">تأهيل بعد الجراحة</option>
              <option value="علاج يدوي">علاج يدوي</option>
            </select>
            <div class="error-message" id="service-error">الرجاء اختيار نوع الجلسة.</div>
          </div>

          <div class="form-group">
            <label for="branch" class="required">الفرع المفضل</label>
            <select id="branch" name="branch" required aria-describedby="branch-error">
              <option value="">اختر الفرع</option>
              <option value="6th of October - Arkan Mall">6th of October - Arkan Mall</option>
              <option value="Maadi">Maadi</option>
              <option value="Nasr City">Nasr City</option>
              <option value="Mohandseen">Mohandseen</option>
              <option value="Mansoura">Mansoura</option>
              <option value="Fifth Settlement - Eden Mall">Fifth Settlement - Eden Mall</option>
              <option value="Sheikh Zayed - Arkan Mall">Sheikh Zayed - Arkan Mall</option>
            </select>
            <div class="error-message" id="branch-error">الرجاء اختيار الفرع المفضل.</div>
          </div>

          <div class="form-group">
            <label for="doctor-name" class="required">اسم الدكتور (باللغة الإنجليزية)</label>
            <input type="text" id="doctor-name" name="doctor-name" placeholder="أدخل اسم الدكتور" required pattern="[A-Za-z\s]+" title="الرجاء إدخال حروف إنجليزية فقط">
            <div class="error-message" id="doctor-name-error">الرجاء إدخال اسم الدكتور باللغة الإنجليزية.</div>
          </div>

          <div class="form-group">
            <label for="appointment-date" class="required">تاريخ الجلسة</label>
            <input type="date" id="appointment-date" name="appointment-date" required>
            <div class="error-message" id="appointment-date-error">الرجاء اختيار تاريخ الجلسة.</div>
          </div>

          <div class="form-group">
            <label class="required">وقت الجلسة (يمكن اختيار أكثر من موعد)</label>
            <div class="time-slots" id="time-slots-container">
              <!-- Time slots will be dynamically generated here -->
            </div>
            <div class="error-message" id="time-slots-error">الرجاء اختيار وقت واحد على الأقل للجلسة.</div>
          </div>

          <div class="form-group">
            <label for="notes">ملاحظات إضافية (اختياري)</label>
            <textarea id="notes" name="notes" placeholder="أدخل أي ملاحظات إضافية هنا..."></textarea>
          </div>

          <h3><i class="fas fa-upload"></i> رفع الملفات الطبية (اختياري)</h3>
          <p style="text-align: center; color: var(--gray-text); margin-bottom: 20px;">يمكنك رفع صور لتقارير الأشعة أو التحاليل أو أي مستندات طبية أخرى ذات صلة.</p>
          <div class="file-grid">
            <div class="file-box" id="xray-upload">
              <label for="xray-input">
                <i class="fas fa-x-ray icon"></i>
                <span>تقرير أشعة</span>
                <input type="file" id="xray-input" accept="image/*,application/pdf">
              </label>
              <div class="file-progress"></div>
            </div>
            <div class="file-box" id="analysis-upload">
              <label for="analysis-input">
                <i class="fas fa-vials icon"></i>
                <span>تقرير تحاليل</span>
                <input type="file" id="analysis-input" accept="image/*,application/pdf">
              </label>
              <div class="file-progress"></div>
            </div>
            <div class="file-box" id="other-upload">
              <label for="other-input">
                <i class="fas fa-file-medical icon"></i>
                <span>مستندات أخرى</span>
                <input type="file" id="other-input" accept="image/*,application/pdf">
              </label>
              <div class="file-progress"></div>
            </div>
          </div>

          <div class="submit-container">
            <button type="submit" id="submit-button">
              <i class="fas fa-paper-plane"></i> تأكيد الحجز
            </button>
          </div>
        </form>
      </div>

      <div id="about" class="tab-content">
        <h2><i class="fas fa-info-circle"></i> عن PhysioCare</h2>
        <p>PhysioCare هو مركز رائد للعلاج الطبيعي في مصر، ملتزمون بتقديم أعلى مستويات الرعاية الصحية لمرضانا. نؤمن بأن العلاج الطبيعي هو مفتاح استعادة الحركة، تخفيف الألم، وتحسين جودة الحياة. فريقنا من الأطباء والمعالجين المتخصصين يستخدم أحدث التقنيات والأساليب العلاجية لضمان أفضل النتائج.</p>
        <p>نحن نقدم مجموعة واسعة من الخدمات التي تشمل العلاج الطبيعي العام، تأهيل الإصابات الرياضية، علاج كبار السن والأطفال، التأهيل بعد الجراحات، والعلاج اليدوي. هدفنا هو تمكين مرضانا من العودة إلى حياتهم الطبيعية بنشاط وصحة كاملة.</p>
        <p>في PhysioCare، نركز على خطط علاج فردية مصممة خصيصًا لتلبية احتياجات كل مريض، مع التركيز على التعليم والتوعية لضمان استمرارية التحسن بعد انتهاء الجلسات.</p>
      </div>

      <div id="contact" class="tab-content">
        <h2><i class="fas fa-phone-alt"></i> اتصل بنا</h2>
        <p style="text-align: center; color: var(--gray-text); margin-bottom: 30px;">يسعدنا تواصلكم معنا في أي وقت. يمكنكم زيارة أحد فروعنا، الاتصال بنا، أو إرسال رسالة.</p>
        
        <h3>فروعنا</h3>
        <div class="contact-info">
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع 6 أكتوبر - أركان مول</h4>
            <p>الشيخ زايد، داخل أركان مول، مبنى 5، الدور الخامس</p>
            <p>الهاتف: <a href="tel:+20236801398">02-3680-1398</a></p>
            <p><a href="https://maps.app.goo.gl/your_6th_october_location" target="_blank">عرض على الخريطة</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع المعادي</h4>
            <p>5 شارع وادي النيل، شقة 31، الدور الثالث، كورنيش المعادي</p>
            <p>الهاتف: <a href="tel:+20225174847">02-25174847</a></p>
            <p><a href="https://maps.app.goo.gl/your_maadi_location" target="_blank">عرض على الخريطة</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع التجمع الخامس - إيدن مول</h4>
            <p>شارع الجزيرة، إيدن مول، الحي الرابع، التجمع الخامس</p>
            <p>الهاتف: <a href="tel:+201024443117">01024443117</a></p>
            <p><a href="https://maps.app.goo.gl/your_fifth_settlement_location" target="_blank">عرض على الخريطة</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع مدينة نصر</h4>
            <p>العنوان غير متوفر حالياً</p>
            <p>الهاتف: <a href="tel:+20226775495">02-2677-5495</a></p>
            <p><a href="#" target="_blank">عرض على الخريطة</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع المهندسين</h4>
            <p>العنوان غير متوفر حالياً</p>
            <p>الهاتف: <a href="tel:+20237483802">02-3748-3802</a></p>
            <p><a href="#" target="_blank">عرض على الخريطة</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-map-marker-alt icon"></i>
            <h4>فرع المنصورة</h4>
            <p>العنوان غير متوفر حالياً</p>
            <p>الهاتف: <a href="tel:+20502256155">050-2256-155</a></p>
            <p><a href="#" target="_blank">عرض على الخريطة</a></p>
          </div>
        </div>

        <h3>تواصل معنا مباشرة</h3>
        <div class="contact-info">
          <div class="contact-item">
            <i class="fas fa-phone icon"></i>
            <h4>الخط الساخن</h4>
            <p>للاستفسارات والحجز</p>
            <p><a href="tel:+201024443117">01024443117</a></p>
            <p><a href="tel:+201024443118">01024443118</a></p>
          </div>
          <div class="contact-item">
            <i class="fab fa-whatsapp icon"></i>
            <h4>واتساب</h4>
            <p>للحجز السريع والدعم</p>
            <p><a href="https://wa.me/201024443117" target="_blank">أرسل رسالة واتساب</a></p>
          </div>
          <div class="contact-item">
            <i class="fas fa-envelope icon"></i>
            <h4>البريد الإلكتروني</h4>
            <p>للاستفسارات العامة</p>
            <p><a href="mailto:info@physiocare.com">info@physiocare.com</a></p>
          </div>
        </div>

        <div id="map"></div>

        <form id="contact-form" style="margin-top: 50px;">
          <h3><i class="fas fa-envelope-open-text"></i> أرسل لنا رسالة</h3>
          <div class="form-group">
            <label for="contact-name" class="required">اسمك</label>
            <input type="text" id="contact-name" name="contact-name" placeholder="اسمك بالكامل" required>
          </div>
          <div class="form-group">
            <label for="contact-email" class="required">بريدك الإلكتروني</label>
            <input type="email" id="contact-email" name="contact-email" placeholder="بريدك الإلكتروني" required>
          </div>
          <div class="form-group">
            <label for="contact-subject" class="required">الموضوع</label>
            <input type="text" id="contact-subject" name="contact-subject" placeholder="موضوع الرسالة" required>
          </div>
          <div class="form-group">
            <label for="contact-message" class="required">رسالتك</label>
            <textarea id="contact-message" name="contact-message" placeholder="اكتب رسالتك هنا..." required></textarea>
          </div>
          <div class="submit-container">
            <button type="submit" id="contact-submit-button">
              <i class="fas fa-paper-plane"></i> إرسال الرسالة
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 PhysioCare. جميع الحقوق محفوظة.</p>
  </footer>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    (function() {
      // Firebase Configuration (REPLACE WITH YOUR ACTUAL CONFIG)
      const firebaseConfig = {
        apiKey: "AIzaSyA6_OACwpwaFSiX8jfsjS0_bt_EfIc4rhY", // This should be securely stored, not hardcoded
        authDomain: "your-project-id.firebaseapp.com",
        projectId: "your-project-id",
        storageBucket: "your-project-id.appspot.com",
        messagingSenderId: "your-sender-id",
        appId: "your-app-id"
      };

      // Initialize Firebase
      let db, storage;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        storage = firebase.storage();
        console.log('Firebase initialized successfully');
      } catch (error) {
        console.error('Firebase initialization error:', error);
        showMessage('حدث خطأ في تهيئة Firebase. قد لا تعمل بعض الميزات.', 'error');
      }

      // Global state object
      const state = {
        activeTab: 'booking',
        selectedTimeSlots: [],
        uploadedFiles: {
          xray: null,
          analysis: null,
          other: null
        },
        branches: [
          { name: '6th of October - Arkan Mall', lat: 30.005493, lng: 30.974917, address: 'الشيخ زايد، داخل أركان مول، مبنى 5، الدور الخامس', phone: '02-3680-1398', mapLink: 'https://maps.app.goo.gl/2j3j4j5j6j7j8j9jA' },
          { name: 'Maadi', lat: 29.9678, lng: 31.2467, address: '5 شارع وادي النيل، شقة 31، الدور الثالث، كورنيش المعادي', phone: '02-25174847', mapLink: 'https://maps.app.goo.gl/B2C3D4E5F6G7H8I9J' },
          { name: 'Nasr City', lat: 30.0595, lng: 31.3432, address: 'العنوان: غير متوفر حالياً', phone: '02-2677-5495', mapLink: '#' },
          { name: 'Mohandseen', lat: 30.0426, lng: 31.1969, address: 'العنوان: غير متوفر حالياً', phone: '02-3748-3802', mapLink: '#' },
          { name: 'Mansoura', lat: 31.0379, lng: 31.3815, address: 'العنوان: غير متوفر حالياً', phone: '050-2256-155', mapLink: '#' },
          { name: 'Fifth Settlement - Eden Mall', lat: 30.0123, lng: 31.4567, address: 'شارع الجزيرة، إيدن مول، الحي الرابع، التجمع الخامس', phone: '01024443117', mapLink: 'https://maps.app.goo.gl/K2L3M4N5O6P7Q8R9S' },
          { name: 'Sheikh Zayed - Arkan Mall', lat: 30.005493, lng: 30.974917, address: 'الشيخ زايد، داخل أركان مول، مبنى 5، الدور الخامس', phone: '02-3680-1398', mapLink: 'https://maps.app.goo.gl/2j3j4j5j6j7j8j9jA' } // Duplicate of 6th of October, consider merging or clarifying
        ]
      };

      // Utility functions
      function showMessage(msg, type = 'info', duration = 5000) {
        const container = document.getElementById('message-container');
        if (!container) return;

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.innerHTML = `
          <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : 'fa-info-circle'} icon"></i>
          <span>${msg}</span>
        `;
        container.appendChild(messageDiv);

        setTimeout(() => {
          messageDiv.remove();
        }, duration);
      }

      function sanitizeInput(input) {
        if (typeof input !== 'string') return input;
        return input.trim().replace(/</g, '&lt;').replace(/>/g, '&gt;');
      }

      const validators = {
        name: (value) => value.trim().length > 2,
        phone: (value) => /^01[0-2,5]{1}[0-9]{8}$/.test(value),
        email: (value) => value === '' || /^[^\]+@[^\.]+\.[^\.]+$/.test(value),
        service: (value) => value !== '',
        branch: (value) => value !== '',
        doctorName: (value) => /^[A-Za-z\s]+$/.test(value.trim()), // New validator for doctor name
        appointmentDate: (value) => value !== '',
        timeSlots: () => state.selectedTimeSlots.length > 0
      };

      function validateField(fieldId, validator, errorMessageId) {
        const input = document.getElementById(fieldId);
        const errorDiv = document.getElementById(errorMessageId);
        if (!input || !errorDiv) return true; // Return true if elements not found to avoid blocking

        const isValid = validator(input.value);
        if (isValid) {
          input.classList.remove('invalid');
          input.classList.add('valid');
          errorDiv.style.display = 'none';
        } else {
          input.classList.remove('valid');
          input.classList.add('invalid');
          errorDiv.style.display = 'block';
        }
        return isValid;
      }

      function validateForm() {
        let isValid = true;
        isValid = validateField('name', validators.name, 'name-error') && isValid;
        isValid = validateField('phone', validators.phone, 'phone-error') && isValid;
        isValid = validateField('email', validators.email, 'email-error') && isValid;
        isValid = validateField('service', validators.service, 'service-error') && isValid;
        isValid = validateField('branch', validators.branch, 'branch-error') && isValid;
        isValid = validateField('doctor-name', validators.doctorName, 'doctor-name-error') && isValid; // Validate doctor name
        isValid = validateField('appointment-date', validators.appointmentDate, 'appointment-date-error') && isValid;
        
        // Special validation for time slots as it's a group of elements
        const timeSlotsErrorDiv = document.getElementById('time-slots-error');
        if (state.selectedTimeSlots.length === 0) {
          timeSlotsErrorDiv.style.display = 'block';
          isValid = false;
        } else {
          timeSlotsErrorDiv.style.display = 'none';
        }

        return isValid;
      }

      // Setup functions
      function setupTabNavigation() {
        const navTabs = document.querySelectorAll('.nav-tab');
        const tabContents = document.querySelectorAll('.tab-content');

        navTabs.forEach(tab => {
          tab.addEventListener('click', function(e) {
            e.preventDefault();
            const targetTab = this.dataset.tab;

            navTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            tabContents.forEach(content => {
              if (content.id === targetTab) {
                content.classList.add('active');
              } else {
                content.classList.remove('active');
              }
            });
            state.activeTab = targetTab;
            console.log('Tab switched to:', targetTab);

            // Re-initialize map if contact tab is active
            if (targetTab === 'contact') {
              initializeMap();
            }
          });
        });
      }

      function setupDateConstraints() {
        const appointmentDateInput = document.getElementById('appointment-date');
        if (appointmentDateInput) {
          const today = new Date();
          const tomorrow = new Date(today);
          tomorrow.setDate(tomorrow.getDate() + 1);
          appointmentDateInput.min = tomorrow.toISOString().split('T')[0];

          appointmentDateInput.addEventListener('change', generateTimeSlots);
        }
      }

      function generateTimeSlots() {
        const timeSlotsContainer = document.getElementById('time-slots-container');
        if (!timeSlotsContainer) return;

        timeSlotsContainer.innerHTML = ''; // Clear existing slots
        state.selectedTimeSlots = []; // Clear selected slots

        const selectedDate = new Date(document.getElementById('appointment-date').value);
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        const isToday = selectedDate.toDateString() === today.toDateString();

        const availableTimes = [
          '09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
          '01:00 PM', '02:00 PM', '03:00 PM', '04:00 PM',
          '05:00 PM', '06:00 PM', '07:00 PM', '08:00 PM'
        ];

        availableTimes.forEach(time => {
          const timeSlotDiv = document.createElement('div');
          timeSlotDiv.className = 'time-slot';
          timeSlotDiv.textContent = time;
          timeSlotDiv.dataset.time = time;

          // Disable past times if selected date is today
          if (isToday) {
            const [hour, minute] = time.split(':').map(Number);
            const slotDateTime = new Date(selectedDate);
            slotDateTime.setHours(hour, minute, 0, 0);
            if (slotDateTime <= new Date()) {
              timeSlotDiv.classList.add('unavailable');
              timeSlotDiv.title = 'هذا الموعد غير متاح';
            }
          }

          timeSlotDiv.addEventListener('click', function() {
            if (this.classList.contains('unavailable')) return;

            this.classList.toggle('active');
            const timeValue = this.dataset.time;
            const index = state.selectedTimeSlots.indexOf(timeValue);

            if (index > -1) {
              state.selectedTimeSlots.splice(index, 1); // Remove if already selected
            } else {
              state.selectedTimeSlots.push(timeValue); // Add if not selected
            }
            validateForm(); // Re-validate time slots
            console.log('Selected time slots:', state.selectedTimeSlots);
          });
          timeSlotsContainer.appendChild(timeSlotDiv);
        });
      }

      function setupFileHandling() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(input => {
          input.addEventListener('change', function() {
            const fileBox = this.closest('.file-box');
            const fileType = this.id.replace('-input', '');
            if (this.files.length > 0) {
              const file = this.files[0];
              state.uploadedFiles[fileType] = file;
              fileBox.classList.add('has-file');
              fileBox.querySelector('span').textContent = file.name;
              // Simulate upload progress
              let progress = 0;
              const progressBar = fileBox.querySelector('.file-progress');
              const interval = setInterval(() => {
                progress += 10;
                progressBar.style.width = `${progress}%`;
                if (progress >= 100) {
                  clearInterval(interval);
                  progressBar.style.width = '0%'; // Reset for next upload
                }
              }, 100);
              showMessage(`تم اختيار ملف ${file.name}`, 'info');
            } else {
              state.uploadedFiles[fileType] = null;
              fileBox.classList.remove('has-file');
              fileBox.querySelector('span').textContent = fileType === 'xray' ? 'تقرير أشعة' : fileType === 'analysis' ? 'تقرير تحاليل' : 'مستندات أخرى';
            }
            console.log('Uploaded files:', state.uploadedFiles);
          });
        });
      }

      function setupChoiceButtons() {
        // This function is for general choice buttons, not specifically for time slots now
        // Time slots now have their own click handler for multiple selections
      }

      function setupInputValidation() {
        const formInputs = document.querySelectorAll('#booking-form input, #booking-form select, #booking-form textarea');
        formInputs.forEach(input => {
          input.addEventListener('blur', function() {
            if (this.id === 'name') validateField('name', validators.name, 'name-error');
            else if (this.id === 'phone') validateField('phone', validators.phone, 'phone-error');
            else if (this.id === 'email') validateField('email', validators.email, 'email-error');
            else if (this.id === 'alt-phone') validateField('alt-phone', validators.phone, 'alt-phone-error'); // Using phone validator for alt-phone
            else if (this.id === 'service') validateField('service', validators.service, 'service-error');
            else if (this.id === 'branch') validateField('branch', validators.branch, 'branch-error');
            else if (this.id === 'doctor-name') validateField('doctor-name', validators.doctorName, 'doctor-name-error'); // Validate doctor name on blur
            else if (this.id === 'appointment-date') validateField('appointment-date', validators.appointmentDate, 'appointment-date-error');
          });
        });
      }

      function setupChatBot() {
        // Placeholder for chatbot functionality
        console.log('Chatbot setup placeholder');
      }

      function setupContactForm() {
        const contactForm = document.getElementById('contact-form');
        if (contactForm) {
          contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitButton = document.getElementById('contact-submit-button');
            submitButton.disabled = true;
            submitButton.textContent = 'جاري الإرسال...';

            // Basic validation for contact form
            let contactFormValid = true;
            const contactName = document.getElementById('contact-name');
            const contactEmail = document.getElementById('contact-email');
            const contactSubject = document.getElementById('contact-subject');
            const contactMessage = document.getElementById('contact-message');

            if (!validators.name(contactName.value)) { contactName.classList.add('invalid'); contactFormValid = false; }
            else { contactName.classList.remove('invalid'); }
            if (!validators.email(contactEmail.value)) { contactEmail.classList.add('invalid'); contactFormValid = false; }
            else { contactEmail.classList.remove('invalid'); }
            if (contactSubject.value.trim() === '') { contactSubject.classList.add('invalid'); contactFormValid = false; }
            else { contactSubject.classList.remove('invalid'); }
            if (contactMessage.value.trim() === '') { contactMessage.classList.add('invalid'); contactFormValid = false; }
            else { contactMessage.classList.remove('invalid'); }

            if (!contactFormValid) {
              showMessage('الرجاء ملء جميع الحقول المطلوبة في نموذج الاتصال.', 'error');
              submitButton.disabled = false;
              submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> إرسال الرسالة';
              return;
            }

            showMessage('جاري إرسال رسالتك...', 'info');

            try {
              // Simulate sending email
              await new Promise(resolve => setTimeout(resolve, 2000));
              console.log('Contact form submitted:', {
                name: sanitizeInput(contactName.value),
                email: sanitizeInput(contactEmail.value),
                subject: sanitizeInput(contactSubject.value),
                message: sanitizeInput(contactMessage.value)
              });
              showMessage('تم إرسال رسالتك بنجاح! سنتواصل معك قريباً.', 'success');
              contactForm.reset();
            } catch (error) {
              console.error('Contact form submission error:', error);
              showMessage('حدث خطأ أثناء إرسال الرسالة. الرجاء المحاولة مرة أخرى.', 'error');
            } finally {
              submitButton.disabled = false;
              submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> إرسال الرسالة';
            }
          });
        }
      }

      function setupKeyboardNavigation() {
        // Basic keyboard navigation for tabs
        document.querySelectorAll('.nav-tab').forEach(tab => {
          tab.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              tab.click();
            }
          });
        });

        // Basic keyboard navigation for time slots
        document.addEventListener('keydown', (e) => {
          if (state.activeTab === 'booking' && document.activeElement && document.activeElement.classList.contains('time-slot')) {
            const currentSlot = document.activeElement;
            const slots = Array.from(document.querySelectorAll('.time-slot:not(.unavailable)'));
            const currentIndex = slots.indexOf(currentSlot);

            if (e.key === 'ArrowRight') {
              e.preventDefault();
              if (currentIndex < slots.length - 1) {
                slots[currentIndex + 1].focus();
              }
            } else if (e.key === 'ArrowLeft') {
              e.preventDefault();
              if (currentIndex > 0) {
                slots[currentIndex - 1].focus();
              }
            } else if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              currentSlot.click();
            }
          }
        });
      }

      function setupErrorHandling() {
        window.onerror = function(message, source, lineno, colno, error) {
          console.error('Global error caught:', { message, source, lineno, colno, error });
          showMessage('حدث خطأ غير متوقع. الرجاء المحاولة مرة أخرى أو الاتصال بالدعم.', 'error');
          return true; // Prevent default error handling
        };

        window.addEventListener('unhandledrejection', (event) => {
          console.error('Unhandled promise rejection:', event.reason);
          showMessage('حدث خطأ في عملية غير متزامنة. الرجاء المحاولة مرة أخرى.', 'error');
        });
      }

      function setupPerformanceMonitoring() {
        // Placeholder for performance monitoring (e.g., Google Analytics, custom metrics)
        console.log('Performance monitoring setup placeholder');
      }

      function setupServiceWorker() {
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
              .then(registration => {
                console.log('ServiceWorker registered: ', registration);
              })
              .catch(registrationError => {
                console.log('ServiceWorker registration failed: ', registrationError);
              });
          });
        }
      }

      function setupAnalytics() {
        // Placeholder for analytics (e.g., Google Analytics)
        console.log('Analytics setup placeholder');
      }

      // Map Initialization (Leaflet)
      let map = null;
      function initializeMap() {
        if (map) {
          map.remove(); // Remove existing map if any
        }

        // Default view for Egypt
        const egyptCenter = [26.8206, 30.8025]; 
        map = L.map('map').setView(egyptCenter, 6); // Zoom level 6 for Egypt

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Add markers for branches
        state.branches.forEach(branch => {
          if (branch.lat && branch.lng) {
            L.marker([branch.lat, branch.lng])
              .addTo(map)
              .bindPopup(`<b>${branch.name}</b><br>${branch.address}<br>Phone: ${branch.phone}`)
              .openPopup();
          }
        });

        // Invalidate size to ensure map renders correctly after tab switch
        setTimeout(() => { map.invalidateSize(); }, 100);
      }

      // Form submission
      const form = document.getElementById('booking-form');
      if (form) {
        form.addEventListener('submit', handleFormSubmission);
      }

      async function handleFormSubmission(event) {
        event.preventDefault();
        const submitButton = document.getElementById('submit-button');
        submitButton.disabled = true;
        submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جاري الحجز...';

        if (!validateForm()) {
          showMessage('الرجاء مراجعة البيانات المدخلة وتصحيح الأخطاء.', 'error');
          submitButton.disabled = false;
          submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> تأكيد الحجز';
          return;
        }

        showMessage('جاري تأكيد حجزك...', 'info');

        try {
          // Upload files to Firebase Storage
          const uploadedFileUrls = {};
          for (const type in state.uploadedFiles) {
            const file = state.uploadedFiles[type];
            if (file) {
              const storageRef = storage.ref(`uploads/${file.name}`);
              const snapshot = await storageRef.put(file);
              uploadedFileUrls[type] = await snapshot.ref.getDownloadURL();
              console.log(`File ${type} uploaded:`, uploadedFileUrls[type]);
            }
          }

          // Prepare booking data
          const bookingData = {
            name: sanitizeInput(document.getElementById('name').value),
            phone: sanitizeInput(document.getElementById('phone').value),
            email: sanitizeInput(document.getElementById('email').value),
            altPhone: sanitizeInput(document.getElementById('alt-phone').value),
            service: sanitizeInput(document.getElementById('service').value),
            branch: sanitizeInput(document.getElementById('branch').value),
            doctorName: sanitizeInput(document.getElementById('doctor-name').value), // New field
            appointmentDate: sanitizeInput(document.getElementById('appointment-date').value),
            appointmentTimes: state.selectedTimeSlots, // Multiple times
            notes: sanitizeInput(document.getElementById('notes').value),
            uploadedFiles: uploadedFileUrls,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
          };

          // Save booking to Firestore
          if (db) {
            await db.collection('bookings').add(bookingData);
            showMessage('تم حجز جلستك بنجاح! سنتواصل معك قريباً.', 'success');
            form.reset();
            state.selectedTimeSlots = []; // Clear selected times
            document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('active'));
            document.querySelectorAll('.file-box').forEach(box => {
              box.classList.remove('has-file');
              box.querySelector('span').textContent = box.id === 'xray-upload' ? 'تقرير أشعة' : box.id === 'analysis-upload' ? 'تقرير تحاليل' : 'مستندات أخرى';
            });
            state.uploadedFiles = { xray: null, analysis: null, other: null };
          } else {
            showMessage('خطأ: لم يتم تهيئة قاعدة البيانات. الرجاء المحاولة لاحقاً.', 'error');
          }

        } catch (error) {
          console.error('Booking submission error:', error);
          showMessage('حدث خطأ أثناء تأكيد الحجز. الرجاء المحاولة مرة أخرى.', 'error');
        } finally {
          submitButton.disabled = false;
          submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> تأكيد الحجز';
        }
      }

      // Welcome message
      setTimeout(() => {
        showMessage('مرحباً بكم في PhysioCare! نحن هنا لخدمتكم على مدار الساعة', 'info');
      }, 1000);

      // Initialize all functionalities when DOM is ready
      function initialize() {
        try {
          setupTabNavigation();
          setupDateConstraints();
          setupFileHandling();
          setupChoiceButtons(); // This function is now mostly a placeholder
          setupInputValidation();
          setupChatBot();
          setupContactForm();
          setupKeyboardNavigation();
          setupErrorHandling();
          setupPerformanceMonitoring();
          setupServiceWorker();
          setupAnalytics();
          
          // Form submission is already handled above
          
          console.log('Enhanced PhysioCare application initialized successfully');
          
        } catch (error) {
          console.error('Initialization error:', error);
          showMessage('حدث خطأ في تحميل النظام. يرجى إعادة تحميل الصفحة.', 'error');
        }
      }

      // Start the application
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
      } else {
        initialize();
      }

    })();
  </script>
</body>
</html>

