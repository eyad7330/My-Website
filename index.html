<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysioCare | حجز جلسة علاج طبيعي</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; font-family: 'Cairo', sans-serif; background: #f1f1f1; color: #333; }
    header { background: #009688; padding: 30px; text-align: center; color: white; }
    .container {
      max-width: 750px; background: white; margin: 40px auto;
      padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    label { display: block; margin: 15px 0 5px; }
    input, select, textarea {
      width: 100%; padding: 12px; border: 1px solid #ccc;
      border-radius: 8px; font-size: 15px;
    }
    button {
      background: #009688; color: white; border: none; padding: 15px;
      width: 100%; font-size: 16px; border-radius: 8px;
      margin-top: 20px; cursor: pointer; transition: 0.3s ease;
    }
    button:hover { background: #00796b; }
    footer { text-align: center; color: #777; margin: 40px 0 10px; }
    .choice-group {
      display: flex; flex-wrap: wrap; justify-content: center;
      gap: 15px; margin: 10px 0 20px;
    }
    .choice-button {
      padding: 12px 20px; border: 2px solid transparent;
      background: #f0f0f0; color: #333; font-size: 16px;
      border-radius: 50px; cursor: pointer; transition: 0.3s ease-in-out;
      min-width: 130px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .choice-button:hover {
      background: #e0f2f1; color: #00796b;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .choice-button.active {
      background: linear-gradient(to right, #009688, #00796b);
      color: white; border-color: #00695c;
      box-shadow: 0 4px 12px rgba(0,150,136,0.4);
    }
  </style>
</head>
<body>

<header>
  <h1>PhysioCare</h1>
  <p>احجز جلستك العلاجية بسهولة وأمان</p>
</header>

<div class="container">
  <h2>نموذج حجز جلسة علاج طبيعي</h2>
  <form id="booking-form">
    <label>الاسم الكامل</label>
    <input type="text" id="name" required placeholder="اكتب اسمك ثلاثي">

    <label>رقم الهاتف</label>
    <input type="tel" id="phone" required placeholder="01XXXXXXXXX">

    <label>رقم هاتف احتياطي (اختياري)</label>
    <input type="tel" id="alt-phone" placeholder="01XXXXXXXXX">

    <label>شركة التأمين</label>
    <div class="choice-group" id="insurance-buttons">
      <button type="button" class="choice-button" data-value="Globmed">Globmed</button>
      <button type="button" class="choice-button" data-value="NextCare">NextCare</button>
      <button type="button" class="choice-button" data-value="AXA">AXA</button>
      <button type="button" class="choice-button" data-value="Metlife (Alico)">Metlife (Alico)</button>
      <button type="button" class="choice-button" data-value="MedRight">MedRight</button>
      <button type="button" class="choice-button" data-value="Enppi">Enppi</button>
      <button type="button" class="choice-button" data-value="Bupa">Bupa</button>
      <button type="button" class="choice-button" data-value="Egymed">Egymed</button>
    </div>
    <input type="hidden" id="insurance">

    <label>اختر الفرع</label>
    <div class="choice-group" id="branch-buttons">
      <button type="button" class="choice-button" data-value="إيدن مول - الشيخ زايد">إيدن مول</button>
      <button type="button" class="choice-button" data-value="أركان مول - الشيخ زايد">أركان مول</button>
      <button type="button" class="choice-button" data-value="المعادي">المعادي</button>
      <button type="button" class="choice-button" data-value="المهندسين">المهندسين</button>
      <button type="button" class="choice-button" data-value="التجمع الخامس">التجمع</button>
    </div>
    <input type="hidden" id="branch">

    <label>التاريخ</label>
    <input type="date" id="date" required>

    <label>اختيار الشيفت</label>
    <div class="choice-group" id="shift-buttons">
      <button type="button" class="choice-button" data-value="صباحي">صباحي</button>
      <button type="button" class="choice-button" data-value="مسائي">مسائي</button>
    </div>
    <input type="hidden" id="shift">

    <div id="evening-options" style="display:none">
      <label>أسماء الدكاترة</label>
      <input type="text" id="doctors" placeholder="مثال: محمد صادق، نيره خالد">

      <label>اختيار المواعيد</label>
      <div class="choice-group" id="time-buttons">
        <button type="button" class="choice-button" data-value="4:30 م">4:30 م</button>
        <button type="button" class="choice-button" data-value="5:10 م">5:10 م</button>
        <button type="button" class="choice-button" data-value="5:50 م">5:50 م</button>
        <button type="button" class="choice-button" data-value="6:30 م">6:30 م</button>
        <button type="button" class="choice-button" data-value="7:10 م">7:10 م</button>
        <button type="button" class="choice-button" data-value="7:50 م">7:50 م</button>
        <button type="button" class="choice-button" data-value="8:30 م">8:30 م</button>
        <button type="button" class="choice-button" data-value="9:10 م">9:10 م</button>
        <button type="button" class="choice-button" data-value="9:50 م">9:50 م</button>
      </div>
      <input type="hidden" id="selected-time">
    </div>

    <label>ملاحظات إضافية</label>
    <textarea id="notes" rows="3" placeholder="لو في حاجة تحب توضحها"></textarea>

    <h3>رفع الملفات</h3>
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px;">
      <div><label>الكارنيه</label><input type="file" id="file-carnet"></div>
      <div><label>البطاقة</label><input type="file" id="file-id"></div>
      <div><label>الروشتة</label><input type="file" id="file-prescription"></div>
      <div><label>الموافقة</label><input type="file" id="file-approval"></div>
      <div><label>أشعة</label><input type="file" id="file-xray1"></div>
      <div><label>أشعة أخرى</label><input type="file" id="file-xray2"></div>
      <div><label>تقرير طبي</label><input type="file" id="file-medical"></div>
      <div><label>أخرى</label><input type="file" id="file-other"></div>
    </div>

    <button type="submit">احجز الآن</button>
  </form>
</div>

<footer>جميع الحقوق محفوظة &copy; PhysioCare 2025</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA6_OACwpwaFSiX8jfsjS0_bt_EfIc4rhY",
    authDomain: "physiocare-booking.firebaseapp.com",
    projectId: "physiocare-booking",
    storageBucket: "physiocare-booking.firebasestorage.app",
    messagingSenderId: "815959251074",
    appId: "1:815959251074:web:cfd13396b4072b90ccbc9b"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  function activateChoice(groupId, hiddenId) {
    const buttons = document.querySelectorAll(`#${groupId} .choice-button`);
    const input = document.getElementById(hiddenId);
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        input.value = btn.dataset.value;
      });
    });
  }

  function activateMultiChoice(groupId, hiddenId) {
    const buttons = document.querySelectorAll(`#${groupId} .choice-button`);
    const input = document.getElementById(hiddenId);
    const selected = new Set();
    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const val = btn.dataset.value;
        btn.classList.toggle("active");
        if (selected.has(val)) selected.delete(val);
        else selected.add(val);
        input.value = Array.from(selected).join(", ");
      });
    });
  }

  activateChoice('branch-buttons', 'branch');
  activateChoice('shift-buttons', 'shift');
  activateChoice('insurance-buttons', 'insurance');
  activateMultiChoice('time-buttons', 'selected-time');

  document.querySelectorAll('#shift-buttons .choice-button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('evening-options').style.display = (btn.dataset.value === 'مسائي') ? 'block' : 'none';
    });
  });

  document.getElementById("booking-form").addEventListener("submit", async function(e) {
    e.preventDefault();
    const btn = this.querySelector("button[type='submit']");
    btn.disabled = true;
    btn.textContent = "جارٍ إرسال الحجز...";

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const altPhone = document.getElementById("alt-phone").value.trim();
    const insurance = document.getElementById("insurance").value.trim();
    const branch = document.getElementById("branch").value.trim();
    const date = document.getElementById("date").value;
    const shift = document.getElementById("shift").value;
    const doctors = document.getElementById("doctors").value.trim();
    const time = document.getElementById("selected-time").value.trim();
    const notes = document.getElementById("notes").value.trim();

    const fileInputs = {
      carnet: document.getElementById("file-carnet"),
      id: document.getElementById("file-id"),
      prescription: document.getElementById("file-prescription"),
      approval: document.getElementById("file-approval"),
      xray1: document.getElementById("file-xray1"),
      xray2: document.getElementById("file-xray2"),
      medical: document.getElementById("file-medical"),
      other: document.getElementById("file-other")
    };

    const uploadedFiles = {};

    const uploadFile = async (label, fileInput) => {
      if (fileInput && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const fileRef = storage.ref().child(`bookings/${Date.now()}_${file.name}`);
        await fileRef.put(file);
        const url = await fileRef.getDownloadURL();
        uploadedFiles[label] = url;
      }
    };

    const uploadTasks = [];
    for (const [label, input] of Object.entries(fileInputs)) {
      uploadTasks.push(uploadFile(label, input));
    }
    await Promise.all(uploadTasks);

    await db.collection("bookings").add({
      name, phone, altPhone, insurance, branch, date, shift,
      doctors, time, notes, files: uploadedFiles,
      createdAt: new Date()
    });

    alert("✅ تم إرسال الحجز بنجاح!");
    location.reload();
  });
</script>

</body>
</html>
