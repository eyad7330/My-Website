<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysioCare | حجز جلسة علاج طبيعي</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; margin: 0; background: #f1f1f1; color: #333; }
    header { background: #009688; padding: 30px; text-align: center; color: white; }
    .container {
      max-width: 800px; margin: 40px auto; background: white;
      padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    label { display: block; margin: 15px 0 5px; }
    input, textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; }
    button {
      background: #009688; color: white; padding: 15px; border: none;
      width: 100%; border-radius: 8px; margin-top: 20px; font-size: 16px;
    }
    button:hover { background: #00796b; }
    .choice-group {
      display: flex; flex-wrap: wrap; gap: 10px; margin: 10px 0 20px;
    }
    .choice-button {
      padding: 10px 20px; border-radius: 20px; border: 2px solid #ccc;
      background: #f8f8f8; cursor: pointer;
    }
    .choice-button.active {
      background: linear-gradient(to right, #009688, #00796b);
      color: white; border-color: #00695c;
    }
    .file-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 15px;
    }
  </style>
</head>
<body>

<header>
  <h1>PhysioCare</h1>
  <p>احجز جلستك بسهولة</p>
</header>

<div class="container">
  <form id="booking-form">
  <label>الاسم الكامل</label>
  <input type="text" id="name" required>

  <label>رقم الهاتف</label>
  <input type="tel" id="phone" required>

  <label>رقم هاتف احتياطي</label>
  <input type="tel" id="alt-phone">

  <label>شركة التأمين</label>
  <label style="font-size: 14px; color: #555; margin-top: 5px;">اختر شركة التأمين:</label>
  <div class="choice-group" id="insurance-buttons">
    <!-- buttons -->
  </div>
  <input type="hidden" id="insurance" required>

  <label>الفرع</label>
  <label style="font-size: 14px; color: #555;">اختر الفرع:</label>
  <div class="choice-group" id="branch-buttons">
    <!-- buttons -->
  </div>
  <input type="hidden" id="branch" required>

  <label>اختر التاريخ</label>
  <input type="date" id="date" required style="margin-bottom: 15px;">

  <label>الشيفت</label>
  <label style="font-size: 14px; color: #555;">اختر الشيفت:</label>
  <div class="choice-group" id="shift-buttons">
    <!-- buttons -->
  </div>
  <input type="hidden" id="shift" required>

  <div id="evening-options" style="display: none;">
    <label>اسم الدكتور (يمكن كتابة أكثر من اسم)</label>
    <input type="text" id="doctors">

    <label>اختر المواعيد</label>
    <div class="choice-group" id="time-buttons">
      <!-- buttons -->
    </div>
    <input type="hidden" id="selected-time">
  </div>
    <label>الاسم الكامل</label>
    <input type="text" id="name" required>

    <label>رقم الهاتف</label>
    <input type="tel" id="phone" required>

    <label>رقم هاتف احتياطي</label>
    <input type="tel" id="alt-phone">

    <label>شركة التأمين</label>
    <div class="choice-group" id="insurance-buttons">
      <button type="button" class="choice-button" data-value="Globmed">Globmed</button>
      <button type="button" class="choice-button" data-value="NextCare">NextCare</button>
      <button type="button" class="choice-button" data-value="AXA">AXA</button>
      <button type="button" class="choice-button" data-value="Metlife (Alico)">Metlife (Alico)</button>
      <button type="button" class="choice-button" data-value="MedRight">MedRight</button>
      <button type="button" class="choice-button" data-value="Enppi">Enppi</button>
      <button type="button" class="choice-button" data-value="Bupa">Bupa</button>
      <button type="button" class="choice-button" data-value="Egymed">Egymed</button>
    </div>
    <input type="hidden" id="insurance" required>

    <label>الفرع</label>
    <div class="choice-group" id="branch-buttons">
      <button type="button" class="choice-button" data-value="إيدن مول">إيدن مول</button>
      <button type="button" class="choice-button" data-value="أركان مول">أركان مول</button>
      <button type="button" class="choice-button" data-value="المعادي">المعادي</button>
      <button type="button" class="choice-button" data-value="المهندسين">المهندسين</button>
      <button type="button" class="choice-button" data-value="التجمع">التجمع</button>
    </div>
    <input type="hidden" id="branch" required>

    <label>التاريخ</label>
    <input type="date" id="date" required>

    <label>الشيفت</label>
    <div class="choice-group" id="shift-buttons">
      <button type="button" class="choice-button" data-value="صباحي">صباحي</button>
      <button type="button" class="choice-button" data-value="مسائي">مسائي</button>
    </div>
    <input type="hidden" id="shift" required>

    <div id="evening-options" style="display: none;">
      <label>اسم الدكتور (يمكن كتابة أكثر من اسم)</label>
      <input type="text" id="doctors">

      <label>اختر المواعيد</label>
      <div class="choice-group" id="time-buttons">
        <button type="button" class="choice-button" data-value="4:30 م">4:30 م</button>
        <button type="button" class="choice-button" data-value="5:10 م">5:10 م</button>
        <button type="button" class="choice-button" data-value="6:30 م">6:30 م</button>
        <button type="button" class="choice-button" data-value="7:50 م">7:50 م</button>
      </div>
      <input type="hidden" id="selected-time">
    </div>

    <h3>رفع الملفات</h3>
    <div class="file-grid">
      <div><label>الكارنيه</label><input type="file" id="file-carnet" accept="image/*,application/pdf"></div>
      <div><label>البطاقة</label><input type="file" id="file-id" accept="image/*,application/pdf"></div>
      <div><label>الروشتة</label><input type="file" id="file-prescription" accept="image/*,application/pdf"></div>
      <div><label>الموافقة</label><input type="file" id="file-approval" accept="image/*,application/pdf"></div>
      <div><label>أشعة</label><input type="file" id="file-xray1" accept="image/*,application/pdf"></div>
      <div><label>أشعة أخرى</label><input type="file" id="file-xray2" accept="image/*,application/pdf"></div>
      <div><label>تقرير طبي</label><input type="file" id="file-medical" accept="image/*,application/pdf"></div>
      <div><label>أخرى</label><input type="file" id="file-other" accept="image/*,application/pdf"></div>
    </div>

    <button type="submit">احجز الآن</button>
  </form>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA6_OACwpwaFSiX8jfsjS0_bt_EfIc4rhY",
    authDomain: "physiocare-booking.firebaseapp.com",
    projectId: "physiocare-booking",
    storageBucket: "physiocare-booking.appspot.com",
    messagingSenderId: "815959251074",
    appId: "1:815959251074:web:cfd13396b4072b90ccbc9b",
    measurementId: "G-HBYJGQRVBB"
  };
  firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();
  const db = firebase.firestore();
</script>

<script>
  const activateChoice = (groupId, inputId) => {
    const buttons = document.querySelectorAll(`#${groupId} .choice-button`);
    const input = document.getElementById(inputId);
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        buttons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        input.value = btn.dataset.value;
        if (groupId === 'shift-buttons') {
          document.getElementById('evening-options').style.display = (btn.dataset.value === 'مسائي') ? 'block' : 'none';
        }
      });
    });
  };

  const activateMultiChoice = (groupId, inputId) => {
    const buttons = document.querySelectorAll(`#${groupId} .choice-button`);
    const input = document.getElementById(inputId);
    const selected = new Set();
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        const val = btn.dataset.value;
        btn.classList.toggle('active');
        selected.has(val) ? selected.delete(val) : selected.add(val);
        input.value = Array.from(selected).join(", ");
      });
    });
  };

  activateChoice('insurance-buttons', 'insurance');
  activateChoice('branch-buttons', 'branch');
  activateChoice('shift-buttons', 'shift');
  activateMultiChoice('time-buttons', 'selected-time');

  document.getElementById('booking-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      altPhone: document.getElementById('alt-phone').value,
      insurance: document.getElementById('insurance').value,
      branch: document.getElementById('branch').value,
      date: document.getElementById('date').value,
      shift: document.getElementById('shift').value,
      doctors: document.getElementById('doctors').value,
      times: document.getElementById('selected-time').value,
      timestamp: new Date()
    };

    const files = [
      { id: 'file-carnet', name: 'كارنيه' },
      { id: 'file-id', name: 'بطاقة' },
      { id: 'file-prescription', name: 'روشتة' },
      { id: 'file-approval', name: 'موافقة' },
      { id: 'file-xray1', name: 'أشعة' },
      { id: 'file-xray2', name: 'أشعة أخرى' },
      { id: 'file-medical', name: 'تقرير طبي' },
      { id: 'file-other', name: 'أخرى' }
    ];

    const fileLinks = {};
    for (let file of files) {
      const input = document.getElementById(file.id);
      if (input.files.length) {
        const ref = storage.ref(`bookings/${Date.now()}_${file.id}`);
        await ref.put(input.files[0]);
        const url = await ref.getDownloadURL();
        fileLinks[file.name] = url;
      }
    }

    await db.collection('bookings').add({ ...data, files: fileLinks });

    // WhatsApp message to call center
    const message = `حجز جديد - ${data.name}%0aفرع: ${data.branch}%0aتاريخ: ${data.date}%0aشيفت: ${data.shift}%0aدكاترة: ${data.doctors}%0aمواعيد: ${data.times}`;
    window.location.href = `https://wa.me/201024443118?text=${message}`;
  });
</script>

</body>
</html>
